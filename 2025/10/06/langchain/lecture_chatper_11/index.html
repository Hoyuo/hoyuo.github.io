<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"hoyuo.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.25.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"default","dark":"stackoverflow-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":"flat"},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="이 장에서는 지금까지와는 다른 새로운 유형의 애플리케이션, 바로 ChatGPT 플러그인을 만들어 봅니다. FastAPI라는 강력한 Python 웹 프레임워크를 사용하여 API 서버를 구축하고, 이를 ChatGPT와 연동하여 특정 기능을 수행하는 ‘GPT Action’을 구현하는 전체 과정을 배우게 됩니다. 사용자가 입력한 재료에 따라 레시피를 추천해주는 “">
<meta property="og:type" content="article">
<meta property="og:title" content="11. ChatGPT 플러그인 만들기 ChefGPT">
<meta property="og:url" content="https://hoyuo.github.io/2025/10/06/langchain/lecture_chatper_11/index.html">
<meta property="og:site_name" content="Hoyuo&#39;s Blog">
<meta property="og:description" content="이 장에서는 지금까지와는 다른 새로운 유형의 애플리케이션, 바로 ChatGPT 플러그인을 만들어 봅니다. FastAPI라는 강력한 Python 웹 프레임워크를 사용하여 API 서버를 구축하고, 이를 ChatGPT와 연동하여 특정 기능을 수행하는 ‘GPT Action’을 구현하는 전체 과정을 배우게 됩니다. 사용자가 입력한 재료에 따라 레시피를 추천해주는 “">
<meta property="og:locale" content="ko_KR">
<meta property="article:published_time" content="2025-10-05T15:21:00.000Z">
<meta property="article:author" content="Hoyuo">
<meta property="article:tag" content="Fullstack GPT">
<meta property="article:tag" content="langchain">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://hoyuo.github.io/2025/10/06/langchain/lecture_chatper_11/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"ko","comments":true,"permalink":"https://hoyuo.github.io/2025/10/06/langchain/lecture_chatper_11/","path":"2025/10/06/langchain/lecture_chatper_11/","title":"11. ChatGPT 플러그인 만들기 ChefGPT"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>11. ChatGPT 플러그인 만들기 ChefGPT | Hoyuo's Blog</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.10.1/mermaid.min.js","integrity":"sha256-BmQmdWDS8X2OTbrwELWK366LV6escyWhHHe0XCTU/Hk="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Hoyuo's Blog</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Mobile Developer<br/> (Android, iOS, Flutter, RN)</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="검색" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>홈</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>태그<span class="badge">7</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>카테고리<span class="badge">0</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>아카이브<span class="badge">23</span></a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>검색
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="Searching..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          목차
        </li>
        <li class="sidebar-nav-overview">
          흝어보기
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%9D%B4-%EC%9E%A5%EC%97%90%EC%84%9C-%EB%B0%B0%EC%9A%B8-%EB%82%B4%EC%9A%A9"><span class="nav-number">1.</span> <span class="nav-text">이 장에서 배울 내용</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FastAPI%EB%A1%9C-%EC%B2%AB-API-%EC%84%9C%EB%B2%84-%EB%A7%8C%EB%93%A4%EA%B8%B0"><span class="nav-number">2.</span> <span class="nav-text">FastAPI로 첫 API 서버 만들기</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%ED%95%99%EC%8A%B5-%EB%AA%A9%ED%91%9C"><span class="nav-number">2.1.</span> <span class="nav-text">학습 목표</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-1-FastAPI%EC%99%80-Pydantic-%EC%86%8C%EA%B0%9C"><span class="nav-number">2.2.</span> <span class="nav-text">단계 1: FastAPI와 Pydantic 소개</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-2-FastAPI-%EC%95%B1-%EC%B4%88%EA%B8%B0%ED%99%94"><span class="nav-number">2.3.</span> <span class="nav-text">단계 2: FastAPI 앱 초기화</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-3-%EB%8D%B0%EC%9D%B4%ED%84%B0-%EB%AA%A8%EB%8D%B8-%EC%A0%95%EC%9D%98-Quote"><span class="nav-number">2.4.</span> <span class="nav-text">단계 3: 데이터 모델 정의 (Quote)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-4-GET-%EC%97%94%EB%93%9C%ED%8F%AC%EC%9D%B8%ED%8A%B8-%EC%83%9D%EC%84%B1-quote"><span class="nav-number">2.5.</span> <span class="nav-text">단계 4: GET 엔드포인트 생성 (&#x2F;quote)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-5-API-%EC%8B%A4%ED%96%89-%EB%B0%8F-%ED%99%95%EC%9D%B8"><span class="nav-number">2.6.</span> <span class="nav-text">단계 5: API 실행 및 확인</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%B2%B4%ED%81%AC%EB%A6%AC%EC%8A%A4%ED%8A%B8"><span class="nav-number">2.7.</span> <span class="nav-text">체크리스트</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ChatGPT-Action%EC%9D%84-%EC%9C%84%ED%95%9C-%EC%84%9C%EB%B2%84-%EC%84%A4%EC%A0%95"><span class="nav-number">3.</span> <span class="nav-text">ChatGPT Action을 위한 서버 설정</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%ED%95%99%EC%8A%B5-%EB%AA%A9%ED%91%9C-1"><span class="nav-number">3.1.</span> <span class="nav-text">학습 목표</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%B3%80%EA%B2%BD%EB%90%9C-%ED%8C%8C%EC%9D%BC-main-py"><span class="nav-number">3.2.</span> <span class="nav-text">변경된 파일: main.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-1-ChatGPT-Action%EA%B3%BC-API-%EC%97%B0%EB%8F%99%EC%9D%98-%EC%9B%90%EB%A6%AC"><span class="nav-number">3.3.</span> <span class="nav-text">단계 1: ChatGPT Action과 API 연동의 원리</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-2-servers-%EC%84%A4%EC%A0%95-%EC%B6%94%EA%B0%80"><span class="nav-number">3.4.</span> <span class="nav-text">단계 2: servers 설정 추가</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-3-Cloudflare-Tunnel-%EC%86%8C%EA%B0%9C"><span class="nav-number">3.5.</span> <span class="nav-text">단계 3: Cloudflare Tunnel 소개</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%B2%B4%ED%81%AC%EB%A6%AC%EC%8A%A4%ED%8A%B8-1"><span class="nav-number">3.6.</span> <span class="nav-text">체크리스트</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenAI%EB%A5%BC-%EC%9C%84%ED%95%9C-OpenAPI-%ED%99%95%EC%9E%A5"><span class="nav-number">4.</span> <span class="nav-text">OpenAI를 위한 OpenAPI 확장</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%ED%95%99%EC%8A%B5-%EB%AA%A9%ED%91%9C-2"><span class="nav-number">4.1.</span> <span class="nav-text">학습 목표</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%B3%80%EA%B2%BD%EB%90%9C-%ED%8C%8C%EC%9D%BC-main-py-1"><span class="nav-number">4.2.</span> <span class="nav-text">변경된 파일: main.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-1-OpenAPI%EC%99%80-%ED%99%95%EC%9E%A5%EC%84%B1"><span class="nav-number">4.3.</span> <span class="nav-text">단계 1: OpenAPI와 확장성</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-2-openapi-extra-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0"><span class="nav-number">4.4.</span> <span class="nav-text">단계 2: openapi_extra 사용하기</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-3-x-openai-isConsequential-%ED%95%84%EB%93%9C%EC%9D%98-%EC%9D%98%EB%AF%B8"><span class="nav-number">4.5.</span> <span class="nav-text">단계 3: x-openai-isConsequential 필드의 의미</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%B2%B4%ED%81%AC%EB%A6%AC%EC%8A%A4%ED%8A%B8-2"><span class="nav-number">4.6.</span> <span class="nav-text">체크리스트</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#API-%EC%9A%94%EC%B2%AD-%EC%A0%95%EB%B3%B4-%ED%99%95%EC%9D%B8%ED%95%98%EA%B8%B0-API-Key-%EC%9D%B8%EC%A6%9D-%EC%A4%80%EB%B9%84"><span class="nav-number">5.</span> <span class="nav-text">API 요청 정보 확인하기: API Key 인증 준비</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%ED%95%99%EC%8A%B5-%EB%AA%A9%ED%91%9C-3"><span class="nav-number">5.1.</span> <span class="nav-text">학습 목표</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%B3%80%EA%B2%BD%EB%90%9C-%ED%8C%8C%EC%9D%BC-main-py-2"><span class="nav-number">5.2.</span> <span class="nav-text">변경된 파일: main.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-1-API-%EC%9D%B8%EC%A6%9D%EC%9D%98-%ED%95%84%EC%9A%94%EC%84%B1"><span class="nav-number">5.3.</span> <span class="nav-text">단계 1: API 인증의 필요성</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-2-FastAPI%EC%9D%98-Request-%EA%B0%9D%EC%B2%B4"><span class="nav-number">5.4.</span> <span class="nav-text">단계 2: FastAPI의 Request 객체</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-3-%EC%9A%94%EC%B2%AD-%ED%97%A4%EB%8D%94-Request-Headers-%ED%99%95%EC%9D%B8"><span class="nav-number">5.5.</span> <span class="nav-text">단계 3: 요청 헤더(Request Headers) 확인</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%B2%B4%ED%81%AC%EB%A6%AC%EC%8A%A4%ED%8A%B8-3"><span class="nav-number">5.6.</span> <span class="nav-text">체크리스트</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OAuth2%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%82%AC%EC%9A%A9%EC%9E%90-%EC%9D%B8%EC%A6%9D-%EA%B5%AC%ED%98%84"><span class="nav-number">6.</span> <span class="nav-text">OAuth2를 이용한 사용자 인증 구현</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%ED%95%99%EC%8A%B5-%EB%AA%A9%ED%91%9C-4"><span class="nav-number">6.1.</span> <span class="nav-text">학습 목표</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%B3%80%EA%B2%BD%EB%90%9C-%ED%8C%8C%EC%9D%BC-main-py-3"><span class="nav-number">6.2.</span> <span class="nav-text">변경된 파일: main.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-1-OAuth2-%EC%9D%B8%EC%A6%9D-%ED%9D%90%EB%A6%84-Authorization-Code-Grant-%EC%86%8C%EA%B0%9C"><span class="nav-number">6.3.</span> <span class="nav-text">단계 1: OAuth2 인증 흐름(Authorization Code Grant) 소개</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-2-%EC%82%AC%EC%9A%A9%EC%9E%90-%EB%8F%99%EC%9D%98-%ED%99%94%EB%A9%B4-%EA%B5%AC%ED%98%84-authorize"><span class="nav-number">6.4.</span> <span class="nav-text">단계 2: 사용자 동의 화면 구현 (&#x2F;authorize)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-3-%EC%95%A1%EC%84%B8%EC%8A%A4-%ED%86%A0%ED%81%B0-%EA%B5%90%ED%99%98-%EA%B5%AC%ED%98%84-token"><span class="nav-number">6.5.</span> <span class="nav-text">단계 3: 액세스 토큰 교환 구현 (&#x2F;token)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%B2%B4%ED%81%AC%EB%A6%AC%EC%8A%A4%ED%8A%B8-4"><span class="nav-number">6.6.</span> <span class="nav-text">체크리스트</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OpenAPI-%EC%8A%A4%ED%82%A4%EB%A7%88-%EC%A0%95%EB%A6%AC%ED%95%98%EA%B8%B0"><span class="nav-number">7.</span> <span class="nav-text">OpenAPI 스키마 정리하기</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%ED%95%99%EC%8A%B5-%EB%AA%A9%ED%91%9C-5"><span class="nav-number">7.1.</span> <span class="nav-text">학습 목표</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%B3%80%EA%B2%BD%EB%90%9C-%ED%8C%8C%EC%9D%BC-main-py-4"><span class="nav-number">7.2.</span> <span class="nav-text">변경된 파일: main.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-1-%EC%8A%A4%ED%82%A4%EB%A7%88%EC%9D%98-%EC%97%AD%ED%95%A0"><span class="nav-number">7.3.</span> <span class="nav-text">단계 1: 스키마의 역할</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-2-%EC%9D%B8%EC%A6%9D-%EC%9D%B8%ED%94%84%EB%9D%BC%EC%99%80-%EC%95%A1%EC%85%98-%EC%97%94%EB%93%9C%ED%8F%AC%EC%9D%B8%ED%8A%B8%EC%9D%98-%EA%B5%AC%EB%B6%84"><span class="nav-number">7.4.</span> <span class="nav-text">단계 2: 인증 인프라와 액션 엔드포인트의 구분</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-3-include-in-schema-False-%EC%82%AC%EC%9A%A9"><span class="nav-number">7.5.</span> <span class="nav-text">단계 3: include_in_schema&#x3D;False 사용</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%B2%B4%ED%81%AC%EB%A6%AC%EC%8A%A4%ED%8A%B8-5"><span class="nav-number">7.6.</span> <span class="nav-text">체크리스트</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EB%A0%88%EC%8B%9C%ED%94%BC-%EA%B2%80%EC%83%89%EC%9D%84-%EC%9C%84%ED%95%9C-%EB%B2%A1%ED%84%B0-%EB%8D%B0%EC%9D%B4%ED%84%B0%EB%B2%A0%EC%9D%B4%EC%8A%A4-%EC%97%B0%EB%8F%99"><span class="nav-number">8.</span> <span class="nav-text">레시피 검색을 위한 벡터 데이터베이스 연동</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%ED%95%99%EC%8A%B5-%EB%AA%A9%ED%91%9C-6"><span class="nav-number">8.1.</span> <span class="nav-text">학습 목표</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%B3%80%EA%B2%BD%EB%90%9C-%ED%8C%8C%EC%9D%BC-notebook-ipynb"><span class="nav-number">8.2.</span> <span class="nav-text">변경된 파일: notebook.ipynb</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-1-%EC%8B%9C%EB%A7%A8%ED%8B%B1-%EA%B2%80%EC%83%89-Semantic-Search-%EC%86%8C%EA%B0%9C"><span class="nav-number">8.3.</span> <span class="nav-text">단계 1: 시맨틱 검색(Semantic Search) 소개</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-2-Pinecone%EA%B3%BC-LangChain-%EC%84%A4%EC%A0%95"><span class="nav-number">8.4.</span> <span class="nav-text">단계 2: Pinecone과 LangChain 설정</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-3-%EA%B8%B0%EC%A1%B4-%EC%9D%B8%EB%8D%B1%EC%8A%A4%EC%97%90-%EC%97%B0%EA%B2%B0"><span class="nav-number">8.5.</span> <span class="nav-text">단계 3: 기존 인덱스에 연결</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-4-%EC%9C%A0%EC%82%AC%EB%8F%84-%EA%B2%80%EC%83%89-%EC%8B%A4%ED%96%89"><span class="nav-number">8.6.</span> <span class="nav-text">단계 4: 유사도 검색 실행</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%B2%B4%ED%81%AC%EB%A6%AC%EC%8A%A4%ED%8A%B8-6"><span class="nav-number">8.7.</span> <span class="nav-text">체크리스트</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ChefGPT-API-%EC%99%84%EC%84%B1-%EC%8B%9C%EB%A7%A8%ED%8B%B1-%EA%B2%80%EC%83%89-%EA%B8%B0%EB%8A%A5-%ED%86%B5%ED%95%A9"><span class="nav-number">9.</span> <span class="nav-text">ChefGPT API 완성: 시맨틱 검색 기능 통합</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%ED%95%99%EC%8A%B5-%EB%AA%A9%ED%91%9C-7"><span class="nav-number">9.1.</span> <span class="nav-text">학습 목표</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%B3%80%EA%B2%BD%EB%90%9C-%ED%8C%8C%EC%9D%BC-main-py-5"><span class="nav-number">9.2.</span> <span class="nav-text">변경된 파일: main.py</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-1-%ED%94%84%EB%A1%9C%ED%86%A0%ED%83%80%EC%9E%85%EC%97%90%EC%84%9C-%EC%8B%A4%EC%A0%9C-%EC%95%B1%EC%9C%BC%EB%A1%9C"><span class="nav-number">9.3.</span> <span class="nav-text">단계 1: 프로토타입에서 실제 앱으로</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-2-%ED%99%98%EA%B2%BD-%EC%84%A4%EC%A0%95-%EB%B0%8F-%EC%B4%88%EA%B8%B0%ED%99%94"><span class="nav-number">9.4.</span> <span class="nav-text">단계 2: 환경 설정 및 초기화</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-3-API-%EC%97%94%EB%93%9C%ED%8F%AC%EC%9D%B8%ED%8A%B8-%EC%9E%AC%EC%84%A4%EA%B3%84"><span class="nav-number">9.5.</span> <span class="nav-text">단계 3: API 엔드포인트 재설계</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EB%8B%A8%EA%B3%84-4-%EC%99%84%EC%84%B1%EB%90%9C-ChefGPT"><span class="nav-number">9.6.</span> <span class="nav-text">단계 4: 완성된 ChefGPT</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%B2%B4%ED%81%AC%EB%A6%AC%EC%8A%A4%ED%8A%B8-7"><span class="nav-number">9.7.</span> <span class="nav-text">체크리스트</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Hoyuo</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">23</span>
          <span class="site-state-item-name">포스트</span>
        </a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">7</span>
        <span class="site-state-item-name">태그</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="ko">
    <link itemprop="mainEntityOfPage" href="https://hoyuo.github.io/2025/10/06/langchain/lecture_chatper_11/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Hoyuo">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hoyuo's Blog">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="11. ChatGPT 플러그인 만들기 ChefGPT | Hoyuo's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          11. ChatGPT 플러그인 만들기 ChefGPT
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">작성일</span>

      <time title="Post created: 2025-10-06 00:21" itemprop="dateCreated datePublished" datetime="2025-10-06T00:21:00+09:00">2025-10-06</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>이 장에서는 지금까지와는 다른 새로운 유형의 애플리케이션, 바로 ChatGPT 플러그인을 만들어 봅니다. FastAPI라는 강력한 Python 웹 프레임워크를 사용하여 API 서버를 구축하고, 이를 ChatGPT와 연동하여 특정 기능을 수행하는 ‘GPT Action’을 구현하는 전체 과정을 배우게 됩니다. 사용자가 입력한 재료에 따라 레시피를 추천해주는 “ChefGPT”를 만들면서 API 개발, 인증, 그리고 벡터 데이터베이스를 활용한 시맨틱 검색까지 다양한 기술을 경험할 것입니다.</p>
<h2 id="이-장에서-배울-내용"><a href="#이-장에서-배울-내용" class="headerlink" title="이 장에서 배울 내용"></a>이 장에서 배울 내용</h2><ul>
<li><strong>FastAPI 기초</strong>: 현대적인 고성능 웹 프레임워크 FastAPI를 사용하여 API 서버를 구축하는 방법을 배웁니다.</li>
<li><strong>Pydantic 데이터 모델링</strong>: API의 요청 및 응답 데이터 구조를 명확하게 정의하고 검증하는 방법을 익힙니다.</li>
<li><strong>ChatGPT Action 연동</strong>: 우리가 만든 API를 ChatGPT 플러그인으로 등록하고 연동하는 과정을 이해합니다.</li>
<li><strong>OAuth2 인증</strong>: 사용자를 대신하여 안전하게 API를 호출할 수 있도록 OAuth2 인증 흐름을 구현합니다.</li>
<li><strong>Pinecone 벡터 데이터베이스</strong>: 키워드 검색을 넘어, 문맥과 의미를 이해하는 시맨틱 검색을 위해 Pinecone 벡터 데이터베이스를 연동하고 활용하는 방법을 배웁니다.</li>
</ul>
<hr>
<h2 id="FastAPI로-첫-API-서버-만들기"><a href="#FastAPI로-첫-API-서버-만들기" class="headerlink" title="FastAPI로 첫 API 서버 만들기"></a>FastAPI로 첫 API 서버 만들기</h2><p>가장 먼저, 우리의 ChefGPT 플러그인의 핵심이 될 API 서버를 구축합니다. Python 웹 프레임워크 중에서도 간결함과 높은 성능, 그리고 자동 API 문서 생성 기능으로 주목받는 FastAPI를 사용합니다.</p>
<h3 id="학습-목표"><a href="#학습-목표" class="headerlink" title="학습 목표"></a>학습 목표</h3><ul>
<li>FastAPI가 무엇이며 왜 사용하는지 이해하기</li>
<li>기본적인 FastAPI 애플리케이션을 생성하고 실행하는 방법 배우기</li>
<li>Pydantic <code>BaseModel</code>을 사용하여 데이터 모델을 정의하는 방법 익히기</li>
<li><code>@app.get</code> 데코레이터를 사용하여 API 엔드포인트를 만드는 방법 배우기</li>
</ul>
<h3 id="단계-1-FastAPI와-Pydantic-소개"><a href="#단계-1-FastAPI와-Pydantic-소개" class="headerlink" title="단계 1: FastAPI와 Pydantic 소개"></a>단계 1: FastAPI와 Pydantic 소개</h3><p>FastAPI는 이름에서 알 수 있듯 매우 빠른(Fast) API 개발을 지원하는 현대적인 웹 프레임워크입니다. Python 3.7+의 타입 힌트(Type Hint)를 적극적으로 활용하여 코드의 가독성과 안정성을 높입니다.</p>
<p>Pydantic은 FastAPI와 환상의 짝을 이루는 데이터 유효성 검사 라이브러리입니다. Pydantic의 <code>BaseModel</code>을 상속받아 클래스를 정의하면, API가 받아들이거나 반환할 데이터의 형태(스키마)를 명확하게 정의하고, 들어오는 데이터가 이 형태에 맞는지 자동으로 검증해줍니다.</p>
<h3 id="단계-2-FastAPI-앱-초기화"><a href="#단계-2-FastAPI-앱-초기화" class="headerlink" title="단계 2: FastAPI 앱 초기화"></a>단계 2: FastAPI 앱 초기화</h3><p><code>main.py</code> 파일을 생성하고 다음과 같이 FastAPI 애플리케이션을 초기화합니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line">app = FastAPI(</span><br><span class="line">    title=<span class="string">&quot;Nicolacus Maximus Quote Giver&quot;</span>,</span><br><span class="line">    description=<span class="string">&quot;Get a real quote said by Nicolacus Maximus himself.&quot;</span>,</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>FastAPI()</code>를 호출하여 <code>app</code>이라는 FastAPI 인스턴스를 생성합니다.</li>
<li><code>title</code>과 <code>description</code> 매개변수는 나중에 자동으로 생성될 API 문서에 표시될 정보입니다. 처음에는 간단한 “명언 제공기”로 시작합니다.</li>
</ul>
<h3 id="단계-3-데이터-모델-정의-Quote"><a href="#단계-3-데이터-모델-정의-Quote" class="headerlink" title="단계 3: 데이터 모델 정의 (Quote)"></a>단계 3: 데이터 모델 정의 (<code>Quote</code>)</h3><p>Pydantic을 사용하여 API가 반환할 데이터의 구조를 정의합니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py (이어서)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Quote</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    quote: <span class="built_in">str</span> = Field(</span><br><span class="line">        description=<span class="string">&quot;The quote that Nicolacus Maximus said.&quot;</span>,</span><br><span class="line">    )</span><br><span class="line">    year: <span class="built_in">int</span> = Field(</span><br><span class="line">        description=<span class="string">&quot;The year when Nicolacus Maximus said the quote.&quot;</span>,</span><br><span class="line">    )</span><br></pre></td></tr></table></figure>

<ul>
<li><code>BaseModel</code>을 상속받는 <code>Quote</code> 클래스를 만듭니다.</li>
<li><code>quote</code>는 문자열(<code>str</code>), <code>year</code>는 정수(<code>int</code>) 타입임을 명시합니다.</li>
<li><code>Field</code>를 사용하면 각 필드에 대한 추가적인 설명(description)을 달 수 있으며, 이 또한 API 문서에 반영됩니다.</li>
</ul>
<h3 id="단계-4-GET-엔드포인트-생성-quote"><a href="#단계-4-GET-엔드포인트-생성-quote" class="headerlink" title="단계 4: GET 엔드포인트 생성 (/quote)"></a>단계 4: GET 엔드포인트 생성 (<code>/quote</code>)</h3><p>이제 실제 API 요청을 처리할 엔드포인트(URL 경로)를 만듭니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py (이어서)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="string">&quot;/quote&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    summary=<span class="string">&quot;Returns a random quote by Nicolacus Maximus&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    description=<span class="string">&quot;Upon receiving a GET request this endpoint will return a real quiote said by Nicolacus Maximus himself.&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response_description=<span class="string">&quot;A Quote object that contains the quote said by Nicolacus Maximus and the date when the quote was said.&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response_model=Quote,</span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_quote</span>():</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;quote&quot;</span>: <span class="string">&quot;Life is short so eat it all.&quot;</span>,</span><br><span class="line">        <span class="string">&quot;year&quot;</span>: <span class="number">1950</span>,</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><code>@app.get(&quot;/quote&quot;)</code>: 이 데코레이터는 <code>get_quote</code> 함수가 <code>/quote</code> 경로에 대한 GET 요청을 처리하도록 지정합니다.</li>
<li><code>summary</code>, <code>description</code>, <code>response_description</code>: 모두 API 문서를 풍부하게 만들어주는 메타데이터입니다.</li>
<li><code>response_model=Quote</code>: <strong>매우 중요한 부분입니다.</strong> 이 매개변수는 이 엔드포인트의 응답이 <code>Quote</code> 모델의 구조를 따라야 함을 FastAPI에 알려줍니다. FastAPI는 이를 통해 응답 데이터의 유효성을 검사하고, API 문서에 정확한 응답 스키마를 명시할 수 있습니다.</li>
<li><code>get_quote</code> 함수는 <code>Quote</code> 모델과 일치하는 딕셔너리를 반환합니다.</li>
</ul>
<h3 id="단계-5-API-실행-및-확인"><a href="#단계-5-API-실행-및-확인" class="headerlink" title="단계 5: API 실행 및 확인"></a>단계 5: API 실행 및 확인</h3><p>API 서버를 실행하려면, 프로젝트 루트 디렉토리에서 터미널에 다음 명령어를 입력합니다.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">uvicorn main:app --reload</span><br></pre></td></tr></table></figure>

<ul>
<li><code>uvicorn</code>: FastAPI를 위한 고성능 ASGI(Asynchronous Server Gateway Interface) 서버입니다.</li>
<li><code>main:app</code>: <code>main.py</code> 파일 안에 있는 <code>app</code> 인스턴스를 실행하라는 의미입니다.</li>
<li><code>--reload</code>: 코드에 변경이 생길 때마다 서버를 자동으로 재시작해주는 편리한 옵션입니다.</li>
</ul>
<p>서버가 실행되면 웹 브라우저에서 <code>http://127.0.0.1:8000/docs</code>로 접속해 보세요. FastAPI가 코드와 Pydantic 모델을 기반으로 생성한 멋진 대화형 API 문서(Swagger UI)를 확인할 수 있습니다. 여기서 직접 API를 테스트해볼 수도 있습니다.</p>
<h3 id="체크리스트"><a href="#체크리스트" class="headerlink" title="체크리스트"></a>체크리스트</h3><ul>
<li><input disabled="" type="checkbox"> FastAPI와 Pydantic의 역할을 이해했나요?</li>
<li><input disabled="" type="checkbox"> <code>uvicorn</code>을 사용하여 FastAPI 서버를 실행할 수 있나요?</li>
<li><input disabled="" type="checkbox"> Pydantic <code>BaseModel</code>로 데이터 구조를 정의할 수 있나요?</li>
<li><input disabled="" type="checkbox"> <code>@app.get</code> 데코레이터와 <code>response_model</code>의 의미를 이해했나요?</li>
<li><input disabled="" type="checkbox"> <code>http://127.0.0.1:8000/docs</code>에서 자동 생성된 API 문서를 확인했나요?</li>
</ul>
<hr>
<h2 id="ChatGPT-Action을-위한-서버-설정"><a href="#ChatGPT-Action을-위한-서버-설정" class="headerlink" title="ChatGPT Action을 위한 서버 설정"></a>ChatGPT Action을 위한 서버 설정</h2><p>로컬에서 실행되는 우리 API를 인터넷을 통해 ChatGPT가 접근할 수 있도록 만들어야 합니다. 이를 위해 API 문서에 우리 서버의 공개 주소를 알려주는 설정이 필요합니다.</p>
<h3 id="학습-목표-1"><a href="#학습-목표-1" class="headerlink" title="학습 목표"></a>학습 목표</h3><ul>
<li>ChatGPT 플러그인(Action)이 외부 API와 어떻게 통신하는지 이해하기</li>
<li>FastAPI에서 <code>servers</code> 설정을 추가하는 이유와 방법을 배우기</li>
<li>Cloudflare Tunnel과 같은 터널링 서비스의 역할을 이해하기</li>
</ul>
<h3 id="변경된-파일-main-py"><a href="#변경된-파일-main-py" class="headerlink" title="변경된 파일: main.py"></a>변경된 파일: <code>main.py</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line">app = FastAPI(</span><br><span class="line">    title=<span class="string">&quot;Nicolacus Maximus Quote Giver&quot;</span>,</span><br><span class="line">    description=<span class="string">&quot;Get a real quote said by Nicolacus Maximus himself.&quot;</span>,</span><br><span class="line">    servers=[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://rage-adapter-gtk-wooden.trycloudflare.com&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ... (이하 동일)</span></span><br></pre></td></tr></table></figure>

<h3 id="단계-1-ChatGPT-Action과-API-연동의-원리"><a href="#단계-1-ChatGPT-Action과-API-연동의-원리" class="headerlink" title="단계 1: ChatGPT Action과 API 연동의 원리"></a>단계 1: ChatGPT Action과 API 연동의 원리</h3><p>ChatGPT가 우리의 API를 ‘Action’으로 사용하려면, 인터넷에서 접속 가능한 공개 URL 주소가 필요합니다. 현재 우리가 <code>uvicorn</code>으로 실행한 서버 주소인 <code>http://127.0.0.1:8000</code>은 우리 컴퓨터 내부에서만 유효한 주소입니다.</p>
<h3 id="단계-2-servers-설정-추가"><a href="#단계-2-servers-설정-추가" class="headerlink" title="단계 2: servers 설정 추가"></a>단계 2: <code>servers</code> 설정 추가</h3><p>FastAPI 앱을 초기화할 때 <code>servers</code> 매개변수를 추가하여 이 문제를 해결할 수 있습니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app = FastAPI(</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line">    servers=[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://rage-adapter-gtk-wooden.trycloudflare.com&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">)</span><br></pre></td></tr></table></figure>

<ul>
<li><code>servers</code> 매개변수는 생성될 OpenAPI 명세에 API 서버의 공개 주소를 명시하는 역할을 합니다.</li>
<li>ChatGPT와 같은 클라이언트는 이 정보를 보고 실제 API를 호출할 주소를 알게 됩니다.</li>
</ul>
<h3 id="단계-3-Cloudflare-Tunnel-소개"><a href="#단계-3-Cloudflare-Tunnel-소개" class="headerlink" title="단계 3: Cloudflare Tunnel 소개"></a>단계 3: Cloudflare Tunnel 소개</h3><p><code>https://rage-adapter-gtk-wooden.trycloudflare.com</code>와 같은 주소는 어떻게 얻을 수 있을까요? 바로 <strong>Cloudflare Tunnel</strong>이나 <strong>ngrok</strong>과 같은 터널링 서비스를 사용하면 됩니다. 이 서비스들은 로컬 컴퓨터에서 실행 중인 서버(예: <code>localhost:8000</code>)와 인터넷상의 공개 URL을 안전하게 연결해주는 ‘터널’을 만들어 줍니다.</p>
<p>이를 통해 우리는 복잡한 배포 과정 없이도 로컬 환경에서 개발 중인 API를 ChatGPT Action으로 테스트해 볼 수 있습니다.</p>
<h3 id="체크리스트-1"><a href="#체크리스트-1" class="headerlink" title="체크리스트"></a>체크리스트</h3><ul>
<li><input disabled="" type="checkbox"> 로컬 서버를 외부 인터넷에 노출시켜야 하는 이유를 이해했나요?</li>
<li><input disabled="" type="checkbox"> FastAPI의 <code>servers</code> 설정이 OpenAPI 명세에 어떤 영향을 미치는지 알고 있나요?</li>
<li><input disabled="" type="checkbox"> Cloudflare Tunnel이나 ngrok과 같은 터널링 서비스의 기본 개념을 이해했나요?</li>
</ul>
<hr>
<h2 id="OpenAI를-위한-OpenAPI-확장"><a href="#OpenAI를-위한-OpenAPI-확장" class="headerlink" title="OpenAI를 위한 OpenAPI 확장"></a>OpenAI를 위한 OpenAPI 확장</h2><p>OpenAPI는 훌륭한 표준 명세이지만, 특정 플랫폼(여기서는 OpenAI)은 그들만의 추가적인 정보를 요구할 때가 있습니다. FastAPI는 <code>openapi_extra</code> 매개변수를 통해 이러한 플랫폼별 확장을 손쉽게 추가할 수 있도록 지원합니다.</p>
<h3 id="학습-목표-2"><a href="#학습-목표-2" class="headerlink" title="학습 목표"></a>학습 목표</h3><ul>
<li>OpenAPI 스키마를 확장하여 특정 플랫폼에 맞는 정보를 추가하는 방법 배우기</li>
<li><code>openapi_extra</code> 매개변수의 사용법 이해하기</li>
<li><code>x-openai-isConsequential</code> 필드의 의미와 중요성 파악하기</li>
</ul>
<h3 id="변경된-파일-main-py-1"><a href="#변경된-파일-main-py-1" class="headerlink" title="변경된 파일: main.py"></a>변경된 파일: <code>main.py</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ... (상단 생략)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="string">&quot;/quote&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    summary=<span class="string">&quot;Returns a random quote by Nicolacus Maximus&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    description=<span class="string">&quot;Upon receiving a GET request this endpoint will return a real quiote said by Nicolacus Maximus himself.&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response_description=<span class="string">&quot;A Quote object that contains the quote said by Nicolacus Maximus and the date when the quote was said.&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response_model=Quote,</span></span></span><br><span class="line"><span class="params"><span class="meta">    openapi_extra=&#123;</span></span></span><br><span class="line"><span class="params"><span class="meta">        <span class="string">&quot;x-openai-isConsequential&quot;</span>: <span class="literal">False</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    &#125;,</span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_quote</span>():</span><br><span class="line">    <span class="comment"># ... (함수 내용 동일)</span></span><br></pre></td></tr></table></figure>

<h3 id="단계-1-OpenAPI와-확장성"><a href="#단계-1-OpenAPI와-확장성" class="headerlink" title="단계 1: OpenAPI와 확장성"></a>단계 1: OpenAPI와 확장성</h3><p>OpenAPI 명세는 <code>x-</code> 접두사를 사용하여 표준에 없는 사용자 정의 필드를 추가할 수 있도록 허용합니다. OpenAI는 이를 활용하여 GPT Action의 동작 방식을 제어하기 위한 몇 가지 필드를 정의했으며, <code>x-openai-isConsequential</code>이 그중 하나입니다.</p>
<h3 id="단계-2-openapi-extra-사용하기"><a href="#단계-2-openapi-extra-사용하기" class="headerlink" title="단계 2: openapi_extra 사용하기"></a>단계 2: <code>openapi_extra</code> 사용하기</h3><p>FastAPI에서는 각 엔드포인트 데코레이터( <code>@app.get</code>, <code>@app.post</code> 등)에 <code>openapi_extra</code> 매개변수를 전달하여, 생성될 OpenAPI 문서에 손쉽게 사용자 정의 필드를 주입할 수 있습니다.</p>
<h3 id="단계-3-x-openai-isConsequential-필드의-의미"><a href="#단계-3-x-openai-isConsequential-필드의-의미" class="headerlink" title="단계 3: x-openai-isConsequential 필드의 의미"></a>단계 3: <code>x-openai-isConsequential</code> 필드의 의미</h3><p><code>x-openai-isConsequential</code> 필드는 해당 API 호출이 시스템 상태를 변경하는 등 중요한 결과를 초래하는지 여부를 OpenAI에 알려주는 중요한 플래그입니다.</p>
<ul>
<li><strong><code>False</code> (기본값)</strong>: 이 작업은 ‘안전하다’는 의미입니다. 주로 데이터를 읽기만 하는 GET 요청에 해당합니다. ChatGPT는 이 경우 사용자에게 매번 명시적인 확인을 받지 않고 자유롭게 API를 호출할 수 있습니다.</li>
<li><strong><code>True</code></strong>: 이 작업은 중요한 결과를 초래할 수 있다는 의미입니다. 예를 들어, 데이터베이스에 새로운 데이터를 생성(Create), 수정(Update), 삭제(Delete)하거나 이메일을 보내는 등의 작업이 해당됩니다. ChatGPT는 이런 API를 호출하기 전에 반드시 사용자에게 “이 작업을 실행할까요?”라고 확인을 요청합니다.</li>
</ul>
<p>우리의 <code>/quote</code> 엔드포인트는 단순히 하드코딩된 명언을 반환하는 읽기 전용 작업이므로, <code>isConsequential</code> 값을 <code>False</code>로 설정하는 것이 올바릅니다.</p>
<h3 id="체크리스트-2"><a href="#체크리스트-2" class="headerlink" title="체크리스트"></a>체크리스트</h3><ul>
<li><input disabled="" type="checkbox"> OpenAPI 명세에 플랫폼별 확장 필드를 추가해야 하는 이유를 이해했나요?</li>
<li><input disabled="" type="checkbox"> <code>openapi_extra</code>를 사용하여 특정 엔드포인트의 OpenAPI 문서를 수정할 수 있나요?</li>
<li><input disabled="" type="checkbox"> <code>x-openai-isConsequential</code> 플래그가 <code>True</code>일 때와 <code>False</code>일 때 ChatGPT의 동작이 어떻게 달라지는지 이해했나요?</li>
</ul>
<hr>
<h2 id="API-요청-정보-확인하기-API-Key-인증-준비"><a href="#API-요청-정보-확인하기-API-Key-인증-준비" class="headerlink" title="API 요청 정보 확인하기: API Key 인증 준비"></a>API 요청 정보 확인하기: API Key 인증 준비</h2><p>이제 API를 보호하기 위한 첫 단계로, API Key 기반 인증을 준비합니다. 이를 위해 먼저 클라이언트(ChatGPT)가 API를 호출할 때 어떤 정보를 보내는지 확인해야 합니다. FastAPI의 <code>Request</code> 객체를 사용하면 들어오는 모든 HTTP 요청의 세부 정보를 쉽게 들여다볼 수 있습니다.</p>
<h3 id="학습-목표-3"><a href="#학습-목표-3" class="headerlink" title="학습 목표"></a>학습 목표</h3><ul>
<li>FastAPI의 <code>Request</code> 객체를 사용하여 들어오는 HTTP 요청 정보에 접근하는 방법 배우기</li>
<li>API Key 인증의 기본 개념과 헤더의 역할 이해하기</li>
<li><code>request.headers</code>를 통해 클라이언트가 보낸 헤더 정보를 확인하는 방법 익히기</li>
</ul>
<h3 id="변경된-파일-main-py-2"><a href="#변경된-파일-main-py-2" class="headerlink" title="변경된 파일: main.py"></a>변경된 파일: <code>main.py</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> FastAPI, Request <span class="comment"># Request 추가</span></span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"></span><br><span class="line"><span class="comment"># ... (app 초기화 부분 생략)</span></span><br><span class="line"><span class="comment"># ... (Quote 모델 생략)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="comment"># ... (데코레이터 매개변수 생략)</span></span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_quote</span>(<span class="params">request: Request</span>): <span class="comment"># request: Request 인자 추가</span></span><br><span class="line">    <span class="built_in">print</span>(request.headers) <span class="comment"># 헤더 정보 출력</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;quote&quot;</span>: <span class="string">&quot;Life is short so eat it all.&quot;</span>,</span><br><span class="line">        <span class="string">&quot;year&quot;</span>: <span class="number">1950</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># ... (이하 생략)</span></span><br></pre></td></tr></table></figure>

<h3 id="단계-1-API-인증의-필요성"><a href="#단계-1-API-인증의-필요성" class="headerlink" title="단계 1: API 인증의 필요성"></a>단계 1: API 인증의 필요성</h3><p>우리가 만든 API를 아무나 호출할 수 있다면 곤란하겠죠? 가장 간단하고 널리 쓰이는 방법 중 하나는 API Key를 발급하고, 이 키를 가진 클라이언트의 요청만 허용하는 것입니다.</p>
<h3 id="단계-2-FastAPI의-Request-객체"><a href="#단계-2-FastAPI의-Request-객체" class="headerlink" title="단계 2: FastAPI의 Request 객체"></a>단계 2: FastAPI의 <code>Request</code> 객체</h3><p>FastAPI에서 들어오는 요청에 대한 모든 정보는 <code>Request</code> 객체에 담겨 있습니다. 엔드포인트 함수의 인자로 <code>request: Request</code>를 선언하면, FastAPI가 자동으로 해당 요청 객체를 주입해 줍니다.</p>
<h3 id="단계-3-요청-헤더-Request-Headers-확인"><a href="#단계-3-요청-헤더-Request-Headers-확인" class="headerlink" title="단계 3: 요청 헤더(Request Headers) 확인"></a>단계 3: 요청 헤더(Request Headers) 확인</h3><p>API Key는 보통 HTTP 요청의 **헤더(Header)**에 담겨 전달됩니다. <code>Authorization</code> 헤더나 <code>X-API-Key</code> 같은 사용자 정의 헤더가 주로 사용됩니다.</p>
<p><code>print(request.headers)</code> 코드를 추가함으로써, 우리 API가 호출될 때 클라이언트가 보낸 모든 헤더 정보를 서버 로그에서 확인할 수 있습니다. 이 정보를 바탕으로 “ChatGPT가 API Key를 어떤 헤더에 담아 보내는구나”를 파악하고, 다음 단계에서 해당 헤더의 값을 읽어 인증 로직을 구현할 수 있습니다.</p>
<h3 id="체크리스트-3"><a href="#체크리스트-3" class="headerlink" title="체크리스트"></a>체크리스트</h3><ul>
<li><input disabled="" type="checkbox"> API를 보호하기 위해 인증이 왜 필요한지 이해했나요?</li>
<li><input disabled="" type="checkbox"> FastAPI 엔드포인트 함수에서 <code>Request</code> 객체를 어떻게 사용하는지 알고 있나요?</li>
<li><input disabled="" type="checkbox"> <code>request.headers</code>를 통해 요청 헤더를 확인할 수 있나요?</li>
<li><input disabled="" type="checkbox"> API Key가 주로 요청 헤더를 통해 전달된다는 사실을 이해했나요?</li>
</ul>
<hr>
<h2 id="OAuth2를-이용한-사용자-인증-구현"><a href="#OAuth2를-이용한-사용자-인증-구현" class="headerlink" title="OAuth2를 이용한 사용자 인증 구현"></a>OAuth2를 이용한 사용자 인증 구현</h2><p>API Key가 서비스 전체에 대한 접근을 제어한다면, OAuth2는 ‘사용자’를 대신하여 특정 작업을 수행할 수 있도록 허가(Authorization)를 받는 표준 방식입니다. 이를 통해 우리는 사용자별로 다른 데이터에 접근하거나 작업을 수행하는 등 훨씬 정교한 기능을 구현할 수 있습니다.</p>
<h3 id="학습-목표-4"><a href="#학습-목표-4" class="headerlink" title="학습 목표"></a>학습 목표</h3><ul>
<li>OAuth2 인증 흐름(Authorization Code Grant)의 기본 개념 이해하기</li>
<li>FastAPI를 사용하여 <code>/authorize</code> 및 <code>/token</code> 엔드포인트를 구현하는 방법 배우기</li>
<li>ChatGPT Action에서 사용자 인증이 어떻게 동작하는지 파악하기</li>
</ul>
<h3 id="변경된-파일-main-py-3"><a href="#변경된-파일-main-py-3" class="headerlink" title="변경된 파일: main.py"></a>변경된 파일: <code>main.py</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span>, <span class="type">Dict</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Body, FastAPI, Form, Request</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> HTMLResponse</span><br><span class="line"><span class="comment"># ... (기존 import 생략)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ... (app, Quote 모델 생략)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="comment"># ... get_quote 엔드포인트 생략</span></span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_quote</span>(<span class="params">request: Request</span>):</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># --- 신규 추가된 코드 ---</span></span><br><span class="line"></span><br><span class="line">user_token_db = &#123;<span class="string">&quot;ABCDEF&quot;</span>: <span class="string">&quot;nico&quot;</span>&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="string">&quot;/authorize&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response_class=HTMLResponse,</span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_authorize</span>(<span class="params">client_id: <span class="built_in">str</span>, redirect_uri: <span class="built_in">str</span>, state: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    &lt;html&gt;</span></span><br><span class="line"><span class="string">        &lt;head&gt;</span></span><br><span class="line"><span class="string">            &lt;title&gt;Nicolacus Maximus Log In&lt;/title&gt;</span></span><br><span class="line"><span class="string">        &lt;/head&gt;</span></span><br><span class="line"><span class="string">        &lt;body&gt;</span></span><br><span class="line"><span class="string">            &lt;h1&gt;Log Into Nicolacus Maximus&lt;/h1&gt;</span></span><br><span class="line"><span class="string">            &lt;a href=&quot;<span class="subst">&#123;redirect_uri&#125;</span>?code=ABCDEF&amp;state=<span class="subst">&#123;state&#125;</span>&quot;&gt;Authorize Nicolacus Maximus GPT&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/body&gt;</span></span><br><span class="line"><span class="string">    &lt;/html&gt;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"><span class="string">&quot;/token&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_token</span>(<span class="params">code=Form(<span class="params">...</span>)</span>):</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="string">&quot;access_token&quot;</span>: user_token_db[code],</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="단계-1-OAuth2-인증-흐름-Authorization-Code-Grant-소개"><a href="#단계-1-OAuth2-인증-흐름-Authorization-Code-Grant-소개" class="headerlink" title="단계 1: OAuth2 인증 흐름(Authorization Code Grant) 소개"></a>단계 1: OAuth2 인증 흐름(Authorization Code Grant) 소개</h3><p>ChatGPT Action에서 OAuth2는 다음과 같은 순서로 동작합니다.</p>
<ol>
<li><strong>사용자 인증 요청</strong>: ChatGPT가 사용자를 우리 서버의 <code>/authorize</code> URL로 보냅니다.</li>
<li><strong>사용자 동의</strong>: 사용자는 우리 서버가 제공하는 페이지에서 로그인하고 “이 GPT가 내 계정 정보에 접근하는 것을 허용합니다”라고 동의 버튼을 클릭합니다.</li>
<li><strong>임시 코드 발급</strong>: 우리 서버는 사용자를 ChatGPT가 지정한 <code>redirect_uri</code>로 다시 보내면서, 일회용 **임시 코드(Authorization Code)**를 함께 전달합니다.</li>
<li><strong>토큰 교환 요청</strong>: ChatGPT는 백그라운드에서 이 임시 코드를 가지고 우리 서버의 <code>/token</code> 엔드포인트에 POST 요청을 보냅니다.</li>
<li><strong>액세스 토큰 발급</strong>: 우리 서버는 임시 코드가 유효한지 확인하고, 해당 사용자를 위한 **액세스 토큰(Access Token)**을 발급하여 ChatGPT에 전달합니다.</li>
<li><strong>API 호출</strong>: 이후 ChatGPT는 이 액세스 토큰을 모든 API 요청 헤더에 포함하여 보냅니다. 우리 서버는 이 토큰을 보고 “아, 이 요청은 ‘nico’ 사용자를 대신해서 온 것이구나”라고 인식하고 처리합니다.</li>
</ol>
<h3 id="단계-2-사용자-동의-화면-구현-authorize"><a href="#단계-2-사용자-동의-화면-구현-authorize" class="headerlink" title="단계 2: 사용자 동의 화면 구현 (/authorize)"></a>단계 2: 사용자 동의 화면 구현 (<code>/authorize</code>)</h3><p><code>/authorize</code> 엔드포인트는 사용자가 권한을 부여하는 화면을 보여줍니다.</p>
<ul>
<li><code>response_class=HTMLResponse</code>: 이 엔드포인트가 HTML을 반환함을 명시합니다.</li>
<li><code>client_id</code>, <code>redirect_uri</code>, <code>state</code>: OAuth2 표준에 따라 ChatGPT가 전달하는 매개변수들입니다.</li>
<li>함수는 동의 링크가 포함된 간단한 HTML 페이지를 반환합니다.</li>
<li>가장 중요한 부분은 이 링크의 <code>href</code> 속성입니다. 사용자가 링크를 클릭하면, ChatGPT가 알려준 <code>redirect_uri</code>로 이동하면서, 우리 서버가 임시로 발급한 <code>code=ABCDEF</code>와 CSRF 공격 방지를 위한 <code>state</code> 값을 전달합니다.</li>
</ul>
<h3 id="단계-3-액세스-토큰-교환-구현-token"><a href="#단계-3-액세스-토큰-교환-구현-token" class="headerlink" title="단계 3: 액세스 토큰 교환 구현 (/token)"></a>단계 3: 액세스 토큰 교환 구현 (<code>/token</code>)</h3><p><code>/token</code> 엔드포인트는 ChatGPT가 임시 코드를 액세스 토큰으로 교환하기 위해 호출합니다.</p>
<ul>
<li><code>@app.post(&quot;/token&quot;)</code>: POST 요청을 처리합니다.</li>
<li><code>code=Form(...)</code>: 요청의 본문(body)에 form 데이터로 <code>code</code>가 포함되어 올 것을 기대합니다.</li>
<li><code>user_token_db</code>: 실제로는 데이터베이스를 사용해야 하지만, 여기서는 간단한 딕셔너리를 사용하여 <code>code</code> “ABCDEF”가 오면 “nico”라는 액세스 토큰을 반환하도록 시뮬레이션합니다.</li>
</ul>
<h3 id="체크리스트-4"><a href="#체크리스트-4" class="headerlink" title="체크리스트"></a>체크리스트</h3><ul>
<li><input disabled="" type="checkbox"> OAuth2의 목적이 ‘사용자를 대신하여’ API를 호출할 권한을 얻는 것임을 이해했나요?</li>
<li><input disabled="" type="checkbox"> <code>/authorize</code> 엔드포인트의 역할(사용자 동의 및 임시 코드 전달)을 이해했나요?</li>
<li><input disabled="" type="checkbox"> <code>/token</code> 엔드포인트의 역할(임시 코드를 액세스 토큰으로 교환)을 이해했나요?</li>
<li><input disabled="" type="checkbox"> 액세스 토큰이 이후의 API 호출에서 사용자를 식별하는 데 사용된다는 것을 알고 있나요?</li>
</ul>
<hr>
<h2 id="OpenAPI-스키마-정리하기"><a href="#OpenAPI-스키마-정리하기" class="headerlink" title="OpenAPI 스키마 정리하기"></a>OpenAPI 스키마 정리하기</h2><p>우리가 만든 API의 기능 중에는 ChatGPT가 직접 사용할 ‘도구’도 있지만, OAuth2 인증처럼 그 도구를 사용하기 위한 ‘기반 인프라’도 있습니다. API 명세(스키마)에는 ‘도구’에 해당하는 엔드포인트만 노출하여 ChatGPT가 혼동하지 않도록 하는 것이 좋습니다.</p>
<h3 id="학습-목표-5"><a href="#학습-목표-5" class="headerlink" title="학습 목표"></a>학습 목표</h3><ul>
<li>API 스키마에 포함할 엔드포인트와 포함하지 않을 엔드포인트를 구분하는 이유 이해하기</li>
<li>FastAPI에서 <code>include_in_schema=False</code>를 사용하여 특정 엔드포인트를 OpenAPI 문서에서 숨기는 방법 배우기</li>
</ul>
<h3 id="변경된-파일-main-py-4"><a href="#변경된-파일-main-py-4" class="headerlink" title="변경된 파일: main.py"></a>변경된 파일: <code>main.py</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ... (상단 생략)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="string">&quot;/authorize&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response_class=HTMLResponse,</span></span></span><br><span class="line"><span class="params"><span class="meta">    include_in_schema=<span class="literal">False</span>, <span class="comment"># 스키마에서 제외</span></span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_authorize</span>(<span class="params">client_id: <span class="built_in">str</span>, redirect_uri: <span class="built_in">str</span>, state: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="comment"># ...</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.post(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="string">&quot;/token&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    include_in_schema=<span class="literal">False</span>, <span class="comment"># 스키마에서 제외</span></span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">handle_token</span>(<span class="params">code=Form(<span class="params">...</span>)</span>):</span><br><span class="line">    <span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<h3 id="단계-1-스키마의-역할"><a href="#단계-1-스키마의-역할" class="headerlink" title="단계 1: 스키마의 역할"></a>단계 1: 스키마의 역할</h3><p>OpenAPI 스키마(<code>openapi.json</code>)는 ChatGPT에게 “네가 사용할 수 있는 도구(API) 목록은 이것들이야”라고 알려주는 메뉴판과 같습니다.</p>
<h3 id="단계-2-인증-인프라와-액션-엔드포인트의-구분"><a href="#단계-2-인증-인프라와-액션-엔드포인트의-구분" class="headerlink" title="단계 2: 인증 인프라와 액션 엔드포인트의 구분"></a>단계 2: 인증 인프라와 액션 엔드포인트의 구분</h3><ul>
<li><strong>액션 엔드포인트</strong>: AI가 실제 기능을 수행하기 위해 호출하는 API입니다. (예: <code>/recipes</code>) 이들은 스키마에 반드시 포함되어야 합니다.</li>
<li><strong>인증 인프라 엔드포인트</strong>: OAuth2 인증 과정 자체를 위해 시스템 간에 통신하는 API입니다. (예: <code>/authorize</code>, <code>/token</code>) 이들은 AI가 직접 사용하는 도구가 아니므로 스키마에서 제외하는 것이 좋습니다.</li>
</ul>
<h3 id="단계-3-include-in-schema-False-사용"><a href="#단계-3-include-in-schema-False-사용" class="headerlink" title="단계 3: include_in_schema=False 사용"></a>단계 3: <code>include_in_schema=False</code> 사용</h3><p>FastAPI에서는 각 엔드포인트 데코레이터에 <code>include_in_schema=False</code> 옵션을 추가하는 것만으로 간단하게 해당 엔드포인트를 OpenAPI 스키마에서 제외할 수 있습니다.</p>
<p>이렇게 하면 ChatGPT는 오직 자신이 직접 호출해야 할 기능적인 API 엔드포인트 정보만 받게 되어, 더 깔끔하고 명확한 연동이 가능해집니다.</p>
<h3 id="체크리스트-5"><a href="#체크리스트-5" class="headerlink" title="체크리스트"></a>체크리스트</h3><ul>
<li><input disabled="" type="checkbox"> 액션 엔드포인트와 인증 인프라 엔드포인트의 차이를 이해했나요?</li>
<li><input disabled="" type="checkbox"> <code>include_in_schema=False</code> 옵션의 역할을 알고 있나요?</li>
<li><input disabled="" type="checkbox"> API 스키마를 깔끔하게 유지하는 것이 왜 중요한지 이해했나요?</li>
</ul>
<hr>
<h2 id="레시피-검색을-위한-벡터-데이터베이스-연동"><a href="#레시피-검색을-위한-벡터-데이터베이스-연동" class="headerlink" title="레시피 검색을 위한 벡터 데이터베이스 연동"></a>레시피 검색을 위한 벡터 데이터베이스 연동</h2><p>지금까지는 API가 고정된 값을 반환했지만, 이제부터는 실제 데이터를 다루어 봅니다. 특히, 단순한 키워드 검색을 넘어 문맥과 의미를 이해하여 검색하는 ‘시맨틱 검색’을 구현하기 위해 <strong>Pinecone</strong>이라는 벡터 데이터베이스를 사용합니다.</p>
<h3 id="학습-목표-6"><a href="#학습-목표-6" class="headerlink" title="학습 목표"></a>학습 목표</h3><ul>
<li>벡터 데이터베이스와 시맨틱 검색(semantic search)의 기본 개념 이해하기</li>
<li>Pinecone을 사용하여 벡터 인덱스에 연결하는 방법 배우기</li>
<li>LangChain의 <code>OpenAIEmbeddings</code>를 사용하여 텍스트를 벡터로 변환하는 방법 익히기</li>
<li><code>similarity_search</code>를 사용하여 벡터 인덱스에서 관련 문서를 찾는 방법 배우기</li>
</ul>
<h3 id="변경된-파일-notebook-ipynb"><a href="#변경된-파일-notebook-ipynb" class="headerlink" title="변경된 파일: notebook.ipynb"></a>변경된 파일: <code>notebook.ipynb</code></h3><p>이번 단계의 작업은 API 코드를 직접 수정하기보다는, Jupyter Notebook(<code>notebook.ipynb</code>) 환경에서 새로운 데이터 백엔드를 어떻게 연동하고 테스트하는지 보여줍니다.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># notebook.ipynb (새로운 내용)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pinecone</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> langchain.embeddings <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"><span class="keyword">from</span> langchain.vectorstores <span class="keyword">import</span> Pinecone</span><br><span class="line"></span><br><span class="line">pinecone.init(</span><br><span class="line">    api_key=os.getenv(<span class="string">&quot;PINECONE_API_KEY&quot;</span>),</span><br><span class="line">    environment=<span class="string">&quot;gcp-starter&quot;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">embeddings = OpenAIEmbeddings()</span><br><span class="line"></span><br><span class="line">vector_store = Pinecone.from_existing_index(</span><br><span class="line">    <span class="string">&quot;recipes&quot;</span>,</span><br><span class="line">    embeddings,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">docs = vector_store.similarity_search(<span class="string">&quot;tofu&quot;</span>)</span><br><span class="line"></span><br><span class="line">docs</span><br></pre></td></tr></table></figure>

<h3 id="단계-1-시맨틱-검색-Semantic-Search-소개"><a href="#단계-1-시맨틱-검색-Semantic-Search-소개" class="headerlink" title="단계 1: 시맨틱 검색(Semantic Search) 소개"></a>단계 1: 시맨틱 검색(Semantic Search) 소개</h3><p>사용자가 “두부”를 검색했을 때, 단순히 텍스트에 ‘두부’라는 단어가 포함된 결과만 보여주는 것은 한계가 있습니다. <strong>시맨틱 검색</strong>은 ‘두부’라는 단어의 의미와 문맥을 이해하여, ‘순두부 찌개’나 ‘마파두부’처럼 직접적으로 ‘두부’라는 단어가 없더라도 관련된 레시피를 찾아주는 기술입니다.</p>
<ul>
<li><strong>임베딩(Embeddings)</strong>: 텍스트(단어, 문장)를 의미를 함축한 숫자 벡터(Vector)로 변환하는 기술입니다.</li>
<li><strong>벡터 데이터베이스(Vector Database)</strong>: 이렇게 만들어진 벡터들을 저장하고, 특정 벡터와 ‘의미적으로 유사한’ 다른 벡터들을 매우 빠르게 찾아주는 특화된 데이터베이스입니다. Pinecone이 바로 여기에 해당합니다.</li>
</ul>
<h3 id="단계-2-Pinecone과-LangChain-설정"><a href="#단계-2-Pinecone과-LangChain-설정" class="headerlink" title="단계 2: Pinecone과 LangChain 설정"></a>단계 2: Pinecone과 LangChain 설정</h3><ul>
<li><code>pinecone.init(...)</code>: 환경 변수(<code>PINECONE_API_KEY</code>)를 읽어 Pinecone 서비스에 연결합니다.</li>
<li><code>OpenAIEmbeddings()</code>: LangChain 라이브러리가 제공하는 기능으로, OpenAI의 강력한 모델을 사용하여 텍스트를 고차원 벡터로 변환하는 역할을 합니다.</li>
</ul>
<h3 id="단계-3-기존-인덱스에-연결"><a href="#단계-3-기존-인덱스에-연결" class="headerlink" title="단계 3: 기존 인덱스에 연결"></a>단계 3: 기존 인덱스에 연결</h3><ul>
<li><code>Pinecone.from_existing_index(&quot;recipes&quot;, embeddings)</code>: Pinecone에 미리 생성해 둔 “recipes”라는 이름의 벡터 인덱스에 연결합니다. 이 인덱스에는 <code>recipes.csv</code> 파일의 모든 레시피 정보가 이미 벡터 형태로 변환되어 저장되어 있다고 가정합니다. (실제 인덱스를 생성하고 데이터를 넣는 과정은 이 프로젝트의 범위를 벗어나지만, LangChain을 사용하면 비교적 쉽게 수행할 수 있습니다.)</li>
</ul>
<h3 id="단계-4-유사도-검색-실행"><a href="#단계-4-유사도-검색-실행" class="headerlink" title="단계 4: 유사도 검색 실행"></a>단계 4: 유사도 검색 실행</h3><ul>
<li><code>vector_store.similarity_search(&quot;tofu&quot;)</code>: 이 코드가 바로 시맨틱 검색의 핵심입니다.<ol>
<li><code>OpenAIEmbeddings</code> 모델이 “tofu”라는 검색어를 벡터로 변환합니다.</li>
<li>Pinecone 벡터 스토어는 이 검색어 벡터와 인덱스 안에 있는 모든 레시피 벡터들 간의 ‘유사도’를 계산합니다.</li>
<li>가장 유사도가 높은, 즉 의미적으로 가장 관련 있는 레시피 문서(docs)들을 찾아 반환합니다.</li>
</ol>
</li>
</ul>
<p>이 노트북 코드를 통해, 우리는 API의 백엔드에서 어떻게 시맨틱 검색이 이루어질 것인지 프로토타입을 만들고 테스트한 것입니다.</p>
<h3 id="체크리스트-6"><a href="#체크리스트-6" class="headerlink" title="체크리스트"></a>체크리스트</h3><ul>
<li><input disabled="" type="checkbox"> 시맨틱 검색이 키워드 검색과 어떻게 다른지 이해했나요?</li>
<li><input disabled="" type="checkbox"> 텍스트를 벡터로 변환하는 ‘임베딩’의 역할을 알고 있나요?</li>
<li><input disabled="" type="checkbox"> Pinecone과 같은 벡터 데이터베이스가 왜 필요한지 이해했나요?</li>
<li><input disabled="" type="checkbox"> <code>similarity_search</code>가 어떻게 동작하는지 설명할 수 있나요?</li>
</ul>
<hr>
<h2 id="ChefGPT-API-완성-시맨틱-검색-기능-통합"><a href="#ChefGPT-API-완성-시맨틱-검색-기능-통합" class="headerlink" title="ChefGPT API 완성: 시맨틱 검색 기능 통합"></a>ChefGPT API 완성: 시맨틱 검색 기능 통합</h2><p>이제 모든 조각을 맞출 시간입니다. 이전에서 프로토타이핑했던 Pinecone 벡터 검색 기능을 실제 FastAPI 애플리케이션에 통합하여, 사용자가 요청한 재료에 따라 동적으로 레시피를 찾아주는 완전한 “ChefGPT” API를 완성합니다.</p>
<h3 id="학습-목표-7"><a href="#학습-목표-7" class="headerlink" title="학습 목표"></a>학습 목표</h3><ul>
<li>Jupyter Notebook에서 프로토타이핑한 코드를 실제 FastAPI 애플리케이션에 통합하는 방법 배우기</li>
<li>API 엔드포인트가 사용자 입력을 받아 LangChain과 벡터 데이터베이스를 사용하여 동적 응답을 생성하는 과정 이해하기</li>
<li>API의 목적에 맞게 문서, 데이터 모델, 엔드포인트 로직을 전체적으로 수정하는 방법 익히기</li>
</ul>
<h3 id="변경된-파일-main-py-5"><a href="#변경된-파일-main-py-5" class="headerlink" title="변경된 파일: main.py"></a>변경된 파일: <code>main.py</code></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># main.py</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">Any</span>, <span class="type">Dict</span></span><br><span class="line"><span class="keyword">from</span> fastapi <span class="keyword">import</span> Body, FastAPI, Form, Request</span><br><span class="line"><span class="keyword">from</span> fastapi.responses <span class="keyword">import</span> HTMLResponse</span><br><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> BaseModel, Field</span><br><span class="line"><span class="keyword">from</span> dotenv <span class="keyword">import</span> load_dotenv</span><br><span class="line"><span class="keyword">import</span> pinecone</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> langchain.embeddings <span class="keyword">import</span> OpenAIEmbeddings</span><br><span class="line"><span class="keyword">from</span> langchain.vectorstores <span class="keyword">import</span> Pinecone</span><br><span class="line"></span><br><span class="line">load_dotenv()</span><br><span class="line"></span><br><span class="line">pinecone.init(</span><br><span class="line">    api_key=os.getenv(<span class="string">&quot;PINECONE_API_KEY&quot;</span>),</span><br><span class="line">    environment=<span class="string">&quot;gcp-starter&quot;</span>,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">embeddings = OpenAIEmbeddings()</span><br><span class="line"></span><br><span class="line">vector_store = Pinecone.from_existing_index(</span><br><span class="line">    <span class="string">&quot;recipes&quot;</span>,</span><br><span class="line">    embeddings,</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">app = FastAPI(</span><br><span class="line">    title=<span class="string">&quot;CheftGPT. The best provider of Indian Recipes in the world.&quot;</span>,</span><br><span class="line">    description=<span class="string">&quot;Give ChefGPT the name of an ingredient and it will give you multiple recipes to use that ingredient on in return.&quot;</span>,</span><br><span class="line">    servers=[</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="string">&quot;url&quot;</span>: <span class="string">&quot;https://occupations-partition-governments-analyzed.trycloudflare.com&quot;</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">    ],</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Document</span>(<span class="title class_ inherited__">BaseModel</span>):</span><br><span class="line">    page_content: <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.get(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="meta">    <span class="string">&quot;/recipes&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    summary=<span class="string">&quot;Returns a list of recipes.&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    description=<span class="string">&quot;Upon receiving an ingredient, this endpoint will return a list of recipes that contain that ingredient.&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response_description=<span class="string">&quot;A Document object that contains the recipe and preparation instructions&quot;</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    response_model=<span class="built_in">list</span>[Document],</span></span></span><br><span class="line"><span class="params"><span class="meta">    openapi_extra=&#123;</span></span></span><br><span class="line"><span class="params"><span class="meta">        <span class="string">&quot;x-openai-isConsequential&quot;</span>: <span class="literal">False</span>,</span></span></span><br><span class="line"><span class="params"><span class="meta">    &#125;,</span></span></span><br><span class="line"><span class="params"><span class="meta"></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_recipe</span>(<span class="params">ingredient: <span class="built_in">str</span></span>):</span><br><span class="line">    docs = vector_store.similarity_search(ingredient)</span><br><span class="line">    <span class="keyword">return</span> docs</span><br><span class="line"></span><br><span class="line"><span class="comment"># ... (OAuth 관련 엔드포인트 생략)</span></span><br></pre></td></tr></table></figure>

<h3 id="단계-1-프로토타입에서-실제-앱으로"><a href="#단계-1-프로토타입에서-실제-앱으로" class="headerlink" title="단계 1: 프로토타입에서 실제 앱으로"></a>단계 1: 프로토타입에서 실제 앱으로</h3><p>이전 단계의 <code>notebook.ipynb</code>에서 테스트했던 Pinecone 및 LangChain 관련 코드를 <code>main.py</code> 파일 상단으로 그대로 옮겨옵니다. 이제 API 서버가 시작될 때 벡터 데이터베이스에 연결됩니다.</p>
<h3 id="단계-2-환경-설정-및-초기화"><a href="#단계-2-환경-설정-및-초기화" class="headerlink" title="단계 2: 환경 설정 및 초기화"></a>단계 2: 환경 설정 및 초기화</h3><ul>
<li><code>from dotenv import load_dotenv</code>와 <code>load_dotenv()</code>를 추가하여 <code>.env</code> 파일에 저장된 <code>PINECONE_API_KEY</code>와 같은 비밀 키들을 안전하게 불러옵니다. <strong>코- 드에 API 키를 직접 하드코딩하는 것은 매우 위험한 습관이므로 절대 피해야 합니다.</strong></li>
</ul>
<h3 id="단계-3-API-엔드포인트-재설계"><a href="#단계-3-API-엔드포인트-재설계" class="headerlink" title="단계 3: API 엔드포인트 재설계"></a>단계 3: API 엔드포인트 재설계</h3><p>기존의 <code>/quote</code> 엔드포인트를 레시피 검색 기능에 맞게 완전히 새롭게 설계합니다.</p>
<ul>
<li><strong>경로 변경</strong>: <code>@app.get(&quot;/quote&quot;)</code> -&gt; <code>@app.get(&quot;/recipes&quot;)</code></li>
<li><strong>메타데이터 업데이트</strong>: <code>title</code>, <code>description</code> 등 API 문서 관련 내용을 모두 ChefGPT에 맞게 수정합니다.</li>
<li><strong>입력(Input)</strong>: 함수 인자로 <code>ingredient: str</code>를 선언합니다. FastAPI는 이를 보고 <code>/recipes?ingredient=두부</code> 와 같이 쿼리 파라미터로 <code>ingredient</code>를 받아야 함을 자동으로 인식합니다.</li>
<li><strong>로직(Logic)</strong>: 함수 본문이 <code>docs = vector_store.similarity_search(ingredient)</code>로 변경되었습니다. 이제 함수는 사용자로부터 받은 <code>ingredient</code>를 사용하여 직접 시맨틱 검색을 수행합니다.</li>
<li><strong>출력(Output)</strong>:<ul>
<li><code>response_model</code>이 <code>list[Document]</code>로 변경되었습니다. 이는 LangChain의 <code>similarity_search</code>가 반환하는 문서 리스트의 형식과 일치합니다.</li>
<li><code>Document</code> 모델은 <code>page_content</code>라는 하나의 필드만 가지며, LangChain 문서 객체의 핵심 내용을 담습니다.</li>
<li>함수는 검색 결과인 <code>docs</code>를 그대로 반환합니다. FastAPI는 <code>response_model</code> 정의에 따라 이 객체 리스트를 올바른 JSON 형식으로 변환하여 클라이언트에게 전달합니다.</li>
</ul>
</li>
</ul>
<h3 id="단계-4-완성된-ChefGPT"><a href="#단계-4-완성된-ChefGPT" class="headerlink" title="단계 4: 완성된 ChefGPT"></a>단계 4: 완성된 ChefGPT</h3><p>이제 우리의 API는 사용자가 재료 이름을 주면, Pinecone과 LangChain을 통해 의미적으로 관련된 레시피 목록을 찾아 동적으로 반환하는 완전한 기능을 갖춘 ChefGPT가 되었습니다.</p>
<h3 id="체크리스트-7"><a href="#체크리스트-7" class="headerlink" title="체크리스트"></a>체크리스트</h3><ul>
<li><input disabled="" type="checkbox"> <code>.env</code> 파일을 사용하여 API 키를 안전하게 관리하는 방법을 이해했나요?</li>
<li><input disabled="" type="checkbox"> 노트북에서 작성한 코드를 실제 애플리케이션에 어떻게 통합하는지 파악했나요?</li>
<li><input disabled="" type="checkbox"> API 엔드포인트가 쿼리 파라미터를 통해 사용자 입력을 어떻게 받는지 알고 있나요?</li>
<li><input disabled="" type="checkbox"> 사용자 입력을 받아 벡터 검색을 수행하고, 그 결과를 동적으로 반환하는 전체 흐름을 설명할 수 있나요?</li>
</ul>
<hr>
<p>출처 : <a target="_blank" rel="noopener" href="https://nomadcoders.co/fullstack-gpt">https://nomadcoders.co/fullstack-gpt</a></p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/langchain/" rel="tag"><i class="fa fa-tag"></i> langchain</a>
              <a href="/tags/Fullstack-GPT/" rel="tag"><i class="fa fa-tag"></i> Fullstack GPT</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2025/10/06/langchain/lecture_chatper_10/" rel="prev" title="10. InvestorGPT - 자율적으로 조사하고 분석하는 AI 에이전트 만들기">
                  <i class="fa fa-angle-left"></i> 10. InvestorGPT - 자율적으로 조사하고 분석하는 AI 에이전트 만들기
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2025/10/06/langchain/lecture_chatper_12/" rel="next" title="12. OpenAI Assistants API로 AI 비서 만들기">
                  12. OpenAI Assistants API로 AI 비서 만들기 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Hoyuo</span>
  </div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>

</body>
</html>
