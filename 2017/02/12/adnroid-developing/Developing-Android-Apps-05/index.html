<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"hoyuo.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Content ProvidersWhy? 왜 Content Providers를 사용하는가? 묻는 것은 이상한것이 아닙니다데이터를 안전하게 공유하고 효율적으로 app의 경계선을 넘어서 파일들이나 또는 정말 어떤 다른 것과 같이 넘으려고 하는 것을 허용하기 때문이다캘린더, SMS와 같은 것은 Shared content providers를 이용하여 작동된다Cont">
<meta property="og:type" content="article">
<meta property="og:title" content="5. Content Providers">
<meta property="og:url" content="https://hoyuo.github.io/2017/02/12/adnroid-developing/Developing-Android-Apps-05/index.html">
<meta property="og:site_name" content="Hoyuo&#39;s Blog">
<meta property="og:description" content="Content ProvidersWhy? 왜 Content Providers를 사용하는가? 묻는 것은 이상한것이 아닙니다데이터를 안전하게 공유하고 효율적으로 app의 경계선을 넘어서 파일들이나 또는 정말 어떤 다른 것과 같이 넘으려고 하는 것을 허용하기 때문이다캘린더, SMS와 같은 것은 Shared content providers를 이용하여 작동된다Cont">
<meta property="og:locale" content="ko_KR">
<meta property="og:image" content="https://hoyuo.github.io/img/adnroid-developing/5/1.png">
<meta property="og:image" content="https://hoyuo.github.io/img/adnroid-developing/5/2.png">
<meta property="og:image" content="https://hoyuo.github.io/img/adnroid-developing/5/3.png">
<meta property="og:image" content="https://hoyuo.github.io/img/adnroid-developing/5/4.png">
<meta property="og:image" content="https://hoyuo.github.io/img/adnroid-developing/5/5.png">
<meta property="og:image" content="https://hoyuo.github.io/img/adnroid-developing/5/6.png">
<meta property="og:image" content="https://hoyuo.github.io/img/adnroid-developing/5/3.png">
<meta property="article:published_time" content="2017-02-12T06:00:00.000Z">
<meta property="article:author" content="Hoyuo">
<meta property="article:tag" content="udacity">
<meta property="article:tag" content="android">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://hoyuo.github.io/img/adnroid-developing/5/1.png">

<link rel="canonical" href="https://hoyuo.github.io/2017/02/12/adnroid-developing/Developing-Android-Apps-05/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'ko'
  };
</script>

  <title>5. Content Providers | Hoyuo's Blog</title>
  
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-89785418-1"></script>
    <script>
      if (CONFIG.hostname === location.hostname) {
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'UA-89785418-1');
      }
    </script>






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Hoyuo's Blog</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Android Developer</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>홈</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>태그<span class="badge">11</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>카테고리<span class="badge">8</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>아카이브<span class="badge">45</span></a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>검색
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/Hoyuo" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="ko">
    <link itemprop="mainEntityOfPage" href="https://hoyuo.github.io/2017/02/12/adnroid-developing/Developing-Android-Apps-05/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Hoyuo">
      <meta itemprop="description" content="Hoyuo's programming writting">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hoyuo's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          5. Content Providers
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">작성일</span>

              <time title="Post created: 2017-02-12 15:00" itemprop="dateCreated datePublished" datetime="2017-02-12T15:00:00+09:00">2017-02-12</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/" itemprop="url" rel="index"><span itemprop="name">android</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/android/Developing-Android-Apps/" itemprop="url" rel="index"><span itemprop="name">Developing Android Apps</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="Content-Providers"><a href="#Content-Providers" class="headerlink" title="Content Providers"></a>Content Providers</h2><p><strong>Why?</strong></p>
<p>왜 Content Providers를 사용하는가? 묻는 것은 이상한것이 아닙니다<br>데이터를 안전하게 공유하고 효율적으로 app의 경계선을 넘어서 파일들이나 또는 정말 어떤 다른 것과 같이 넘으려고 하는 것을 허용하기 때문이다<br>캘린더, SMS와 같은 것은 Shared content providers를 이용하여 작동된다<br>Content Providers를 설계하는것은 나중에 다른 App에 날씨 데이터를 공유 하기 위해서 입니다</p>
<p>만약 공유할 필요가 없으면 넘어 가면 됩니다!<br>하지만, 우리는 공부가 목적이닌깐 만듭시다!!</p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/guide/topics/providers/content-providers.html">content providers</a></p>
<p><img src="/img/adnroid-developing/5/1.png"></p>
<p><img src="/img/adnroid-developing/5/2.png"></p>
<p>ContentProvider를 이용해서 widgets, Search가 작동하는 방법입니다<br>APIs의 상당량은 syncing, querying data, UI의 updating을 적절히 하는 과정의 최적화 설계가 되어있습니다<br>Syncadapter, Cursorloader를 나중에 이용하게 됩니다<br>Content Observer를 이용해서 UI를 자동적으로 업데이트 하게 만들 수 있습니다</p>
<hr>
<h2 id="Content-Uri"><a href="#Content-Uri" class="headerlink" title="Content Uri"></a>Content Uri</h2><p><img src="/img/adnroid-developing/5/3.png"></p>
<p>우리는 이제 실제로 작업을 시작해야합니다<br>다음과 같은 순서로 진행을 합니다</p>
<ol>
<li>Application 에서 지원하는 URI를 결정합니다</li>
<li>Contract의 내용을 추가합니다</li>
<li>URI를 각각 지원하는 UriMatcher를 사용합니다</li>
<li>ContentProvider의 6개의 함수를 구현합니다</li>
</ol>
<hr>
<h3 id="1-Application-에서-지원하는-URI를-결정합니다"><a href="#1-Application-에서-지원하는-URI를-결정합니다" class="headerlink" title="1. Application 에서 지원하는 URI를 결정합니다"></a>1. Application 에서 지원하는 URI를 결정합니다</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">content:&#x2F;&#x2F;com.study.sunshine.app&#x2F;weather&#x2F;Seoul,kr<br></code></pre></td></tr></table></figure>

<p>다음과 같이 Seoul지역의 날씨를 조회하는 URI를 사용합니다</p>
<p>커서를 통해서 다음 URI의 반환값을 줍니다</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs plain">content:&#x2F;&#x2F;com.study.sunshine.app&#x2F;weather&#x2F;Busan,kr<br><br>content:&#x2F;&#x2F;com.study.sunshine.app&#x2F;weather&#x2F;Tokyo,jp<br></code></pre></td></tr></table></figure>

<p>다음과 같이 URI를 변경하면 다른 국가, 다른 지역의 날씨 정보를 가져올 수 있습니다</p>
<hr>
<ul>
<li>content:</li>
</ul>
<p>SCHEME : URI에 사용되는 프로토콜을 식별합니다</p>
<ul>
<li>com.study.sunshine.app</li>
</ul>
<p>AUTHORITY : 콘텐츠를 찾는 데 사용되는 고유 글자, 거의 항상 Application의 패키지 이름으로 합니다</p>
<ul>
<li>weather</li>
</ul>
<p>데이터베이스의 테이블을 가리키는 위치입니다</p>
<ul>
<li>Seoul,kr</li>
</ul>
<p>QUERY : 테이블의 원하는 쿼리 데이터를 넣는 것 입니다</p>
<ul>
<li>Seoul,kr?DATE=1485700000</li>
</ul>
<p>다음과 같은 형태로 일반적인 쿼리 형태를 취할 수도 있습니다<br>DATE -&gt; 1970. 01. 01. 00:00:00 을 기준으로 합니다</p>
<hr>
<p><img src="/img/adnroid-developing/5/4.png"></p>
<p>다음과 같은 URI를 정했습니다</p>
<p>2번은 우리의 첫페이지에서 날씨 예보를 보는데 사용하겠고<br>3번은 상세 날씨보기에서 사용을 합니다</p>
<p>1,4번은 데이터 삽입, 수정, 삭제에 사용합니다<br>기본 URI를 잡아두면 테스팅할때 매우 유용합니다</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> WEATHER = <span class="hljs-number">100</span>;<br><span class="hljs-comment">//content://com.study.sunshine.app/weather</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> WEATHER_WITH_LOCATION = <span class="hljs-number">101</span>;<br><span class="hljs-comment">//content://com.study.sunshine.app/weather/[LOCATION]</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> WEATHER_WITH_LOCATION_AND_DATE = <span class="hljs-number">102</span>;<br><span class="hljs-comment">//content://com.study.sunshine.app/weather/[LOCATION]/[DATE]</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> LOCATION = <span class="hljs-number">300</span>;<br><span class="hljs-comment">//content://com.study.sunshine.app/location</span><br></code></pre></td></tr></table></figure>

<p>androidTest - data 폴더<br><a href="/downloads/code/5/TestProvider.java">TestProvider.java</a><br><a href="/downloads/code/5/TestUriMatcher.java">TestUriMatcher.java</a><br><a href="/downloads/code/5/TestWeatherContract.java">TestWeatherContract.java</a></p>
<p>androidTest 폴더<br><a href="/downloads/code/5/TestFetchWeatherTask.java">TestFetchWeatherTask.java</a></p>
<p>기본package data 폴더<br><a href="/downloads/code/5/WeatherProvider.java">WeatherProvider.java</a><br><a href="/downloads/code/5/WeatherContract.java">WeatherContract.java</a></p>
<hr>
<p>WeatherContract 에 URI 관련 정보를 추가했습니다</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String CONTENT_AUTHORITY = <span class="hljs-string">&quot;본인패키지명.앱이름.app&quot;</span>;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> Uri BASE_CONTENT_URI = Uri.parse(<span class="hljs-string">&quot;content://&quot;</span> + CONTENT_AUTHORITY);<br></code></pre></td></tr></table></figure>

<p>CONTENT_AUTHORITY를 이용해서 CONTENT_AUTHORITY_URI를 만들어 줍니다</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String PATH_WEATHER = <span class="hljs-string">&quot;weather&quot;</span>;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String PATH_LOCATION = <span class="hljs-string">&quot;location&quot;</span>;<br></code></pre></td></tr></table></figure>

<p>각각 테이블을 의미합니다</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Uri <span class="hljs-title">buildWeatherUri</span><span class="hljs-params">(<span class="hljs-keyword">long</span> id)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Uri <span class="hljs-title">buildWeatherLocation</span><span class="hljs-params">(String locationSetting)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Uri <span class="hljs-title">buildWeatherLocationWithStartDate</span><span class="hljs-params">(String locationSetting, <span class="hljs-keyword">long</span> startDate)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Uri <span class="hljs-title">buildWeatherLocationWithDate</span><span class="hljs-params">(String locationSetting, <span class="hljs-keyword">long</span> date)</span></span><br></code></pre></td></tr></table></figure>
<p>EnCoding</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title">getLocationSettingFromUri</span><span class="hljs-params">(Uri uri)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getDateFromUri</span><span class="hljs-params">(Uri uri)</span></span><br><span class="hljs-function"></span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">long</span> <span class="hljs-title">getStartDateFromUri</span><span class="hljs-params">(Uri uri)</span></span><br></code></pre></td></tr></table></figure>
<p>DeCoding</p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/net/Uri.Builder.html">UriBuilder API</a></p>
<hr>
<h2 id="연습"><a href="#연습" class="headerlink" title="연습"></a>연습</h2><ul>
<li>WeatherContract.WeatherEntry.buildWeatherLocation() 완성합니다</li>
<li>TestWeatherContract.testBuildWeatherLocation() 이용해서 테스트합니다</li>
</ul>
<h3 id="정답"><a href="#정답" class="headerlink" title="정답"></a>정답</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> Uri <span class="hljs-title">buildWeatherLocation</span><span class="hljs-params">(String locationSetting)</span> </span>&#123;<br>    <span class="hljs-keyword">return</span> CONTENT_URI.buildUpon().appendPath(locationSetting).build();<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="UriMatcher"><a href="#UriMatcher" class="headerlink" title="UriMatcher"></a>UriMatcher</h2><p>ContentProvider에는 UriMatcher를 쉽게 사용할 방법을 제공하고 있습니다<br>ContentProvider는 전달된 URI 따라서 각각의 기능을 수행합니다<br>우리는 4가지의 URI를 구현합니다</p>
<p><img src="/img/adnroid-developing/5/5.png"></p>
<p>각각 다른 작업을 수행합니다</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> WEATHER = <span class="hljs-number">100</span>;<br><span class="hljs-comment">//content://com.study.sunshine.app/weather</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> WEATHER_WITH_LOCATION = <span class="hljs-number">101</span>;<br><span class="hljs-comment">//content://com.study.sunshine.app/weather/[LOCATION]</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> WEATHER_WITH_LOCATION_AND_DATE = <span class="hljs-number">102</span>;<br><span class="hljs-comment">//content://com.study.sunshine.app/weather/[LOCATION]/[DATE]</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> LOCATION = <span class="hljs-number">300</span>;<br><span class="hljs-comment">//content://com.study.sunshine.app/location</span><br></code></pre></td></tr></table></figure>

<p>정해진 static final int 값과 비교하여서 작업을 수행합니다<br>ContentProvider에 전달된 URI의 형태를 알수있는 방법이 필요하기 때문입니다<br>switch - case 문을 이용해서 손 쉽게 처리할 수 있습니다<br>UriMatcher는 다양한 형태의 URI에 표현 구문을 일치 시킬 정규표현식과 같은 역할을 합니다</p>
<p><strong>#</strong> : 숫자<br><strong>*</strong> : 모든 문자열</p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/reference/android/content/UriMatcher.html">UriMatcher API</a></p>
<h2 id="연습-1"><a href="#연습-1" class="headerlink" title="연습"></a>연습</h2><ul>
<li>WeatherProvider.buildUriMatcher() 완성합니다</li>
<li>TestUriMatcher.testUriMatcher() 이용해서 테스트합니다</li>
</ul>
<h3 id="정답-1"><a href="#정답-1" class="headerlink" title="정답"></a>정답</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">static</span> UriMatcher <span class="hljs-title">buildUriMatcher</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> UriMatcher matcher = <span class="hljs-keyword">new</span> UriMatcher(UriMatcher.NO_MATCH);<br>    <span class="hljs-keyword">final</span> String authority = WeatherContract.CONTENT_AUTHORITY;<br><br>    matcher.addURI(authority, WeatherContract.PATH_WEATHER, WEATHER);<br>    matcher.addURI(authority, WeatherContract.PATH_WEATHER + <span class="hljs-string">&quot;/*&quot;</span>, WEATHER_WITH_LOCATION);<br>    matcher.addURI(authority, WeatherContract.PATH_WEATHER + <span class="hljs-string">&quot;/*/#&quot;</span>, WEATHER_WITH_LOCATION_AND_DATE);<br><br>    matcher.addURI(authority, WeatherContract.PATH_LOCATION, LOCATION);<br>    <span class="hljs-keyword">return</span> matcher;<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="ContentProvider-Registry"><a href="#ContentProvider-Registry" class="headerlink" title="ContentProvider Registry"></a>ContentProvider Registry</h2><p>UriMatcher는 ContentProvider를 구현할 때 핵심입니다!!<br>ContentProvider를 사용하기 전에 AndroidManifest.xml에 등록을 하여야 합니다</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml">&lt;provider<br>    android:name=[CONTENT PROVIDER CLASS]<br>    android:authorities=[CONTENT_AUTHORITY]/&gt;<br></code></pre></td></tr></table></figure>

<p>ContentResolver라는 Android Util Class를 사용할 수 있습니다<br>ContentResolver는 AUTHORITY를 사용하여 클래스를 찾아 WeatherProvider를 호출합니다<br>AndroidManifest에 ContentProvider를 등록하여서 WeatherContract와 WeatherContract.CONTENT_AUTHORITY를 등록합시다</p>
<p><a target="_blank" rel="noopener" href="https://developer.android.com/guide/topics/manifest/provider-element.html">Manifest - Providers</a><br><a target="_blank" rel="noopener" href="https://developer.android.com/guide/topics/providers/content-provider-basics.html#ClientProvider">ContentProvider</a></p>
<h2 id="연습-2"><a href="#연습-2" class="headerlink" title="연습"></a>연습</h2><ul>
<li>AndroidManifest에 provider를 등록하세요</li>
<li>TestProvider.testProviderRegistry() 이용해서 테스트합니다</li>
</ul>
<h3 id="정답-2"><a href="#정답-2" class="headerlink" title="정답"></a>정답</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs xml">&lt;provider<br>    android:name=&quot;.data.WeatherProvider&quot;<br>    android:authorities=&quot;본인패키지명.앱이름.app&quot;/&gt;<br></code></pre></td></tr></table></figure>

<hr>
<h2 id="ContentProvider-6-function"><a href="#ContentProvider-6-function" class="headerlink" title="ContentProvider 6 function"></a>ContentProvider 6 function</h2><p>AndroidManifest에 provider를 등록했습니다<br>이제 WeatherProvider를 코딩합시다</p>
<p>ContentProvider 구현이 가장 어려운 부분입니다<br><strong>6개의 함수를 구현해야(Override) 합니다</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span></span><br><span class="hljs-function">Cursor <span class="hljs-title">query</span> <span class="hljs-params">(Uri uri, String[] projection,String selection,</span></span><br><span class="hljs-function"><span class="hljs-params">               String[] selectionArgs, String sortOrder)</span></span><br><span class="hljs-function">Uri <span class="hljs-title">insert</span> <span class="hljs-params">(Uri uri, ContentValues values)</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">update</span> <span class="hljs-params">(Uri uri, ContentValues values,</span></span><br><span class="hljs-function"><span class="hljs-params">             String selection, String[] selectionArgs)</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">delete</span> <span class="hljs-params">(Uri uri,String selection, String[] selectionArgs)</span></span><br><span class="hljs-function">String <span class="hljs-title">getType</span> <span class="hljs-params">(Uri uri)</span></span><br></code></pre></td></tr></table></figure>

<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">boolean</span> <span class="hljs-title">onCreate</span><span class="hljs-params">()</span> </span>&#123;<br>    mOpenHelper = <span class="hljs-keyword">new</span> WeatherDbHelper(getContext());<br>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">true</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>OpenHelper를 인스턴스 등록하여서 사용합니다</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getType</span><span class="hljs-params">(Uri uri)</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> match = sUriMatcher.match(uri);<br><br>    <span class="hljs-keyword">switch</span> (match) &#123;<br>        <span class="hljs-keyword">case</span> WEATHER:<br>            <span class="hljs-keyword">return</span> WeatherContract.WeatherEntry.CONTENT_TYPE;<br>        <span class="hljs-keyword">case</span> LOCATION:<br>            <span class="hljs-keyword">return</span> WeatherContract.LocationEntry.CONTENT_TYPE;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnsupportedOperationException(<span class="hljs-string">&quot;Unknown uri: &quot;</span> + uri);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>입력된 URI가 어떤 형태를 요구하는지 UriMatcher를 통해서 알려줍니다</p>
<h2 id="연습-3"><a href="#연습-3" class="headerlink" title="연습"></a>연습</h2><ul>
<li>WeatherProvider.getType(Uri uri) 완성합니다</li>
<li>TestProvider.testGetType() 이용해서 테스트합니다</li>
</ul>
<h3 id="정답-3"><a href="#정답-3" class="headerlink" title="정답"></a>정답</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> String <span class="hljs-title">getType</span><span class="hljs-params">(Uri uri)</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> match = sUriMatcher.match(uri);<br><br>    <span class="hljs-keyword">switch</span> (match) &#123;<br>        <span class="hljs-keyword">case</span> WEATHER_WITH_LOCATION_AND_DATE:<br>            <span class="hljs-keyword">return</span> WeatherContract.WeatherEntry.CONTENT_ITEM_TYPE;<br>        <span class="hljs-keyword">case</span> WEATHER_WITH_LOCATION:<br>            <span class="hljs-keyword">return</span> WeatherContract.WeatherEntry.CONTENT_TYPE;<br>        <span class="hljs-keyword">case</span> WEATHER:<br>            <span class="hljs-keyword">return</span> WeatherContract.WeatherEntry.CONTENT_TYPE;<br>        <span class="hljs-keyword">case</span> LOCATION:<br>            <span class="hljs-keyword">return</span> WeatherContract.LocationEntry.CONTENT_TYPE;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnsupportedOperationException(<span class="hljs-string">&quot;Unknown uri: &quot;</span> + uri);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>WEATHER_WITH_LOCATION_AND_DATE 은 하나의 아이템이 나와야 합니다<br>WEATHER_WITH_LOCATION은 디렉토리가 나와야 합니다</p>
<hr>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> Cursor <span class="hljs-title">query</span><span class="hljs-params">(Uri uri, String[] projection,</span></span><br><span class="hljs-function"><span class="hljs-params">                    String selection, String[] selectionArgs, String sortOrder)</span></span><br></code></pre></td></tr></table></figure>

<p>query 함수는 제일 구현하기 복잡하고 어렵습니다<br>기본 코드에 뼈대만 잡혀 있습니다<br>이것을 이용해서 구현합니다</p>
<p>switch - case 문을 이용해서 각각의 Cursor를 반환합니다<br>함수 끝 부분에서 전달된 URI를 설정합니다<br>URI의 변화를 모니터링 하기 위해서 입니다</p>
<h2 id="연습-4"><a href="#연습-4" class="headerlink" title="연습"></a>연습</h2><ul>
<li>WeatherProvider.query() 완성합니다</li>
<li>TestProvider.testBasicWeatherQuery(), TestProvider.testBasicLocationQueries() 이용해서 테스트합니다</li>
</ul>
<h3 id="정답-4"><a href="#정답-4" class="headerlink" title="정답"></a>정답</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">case</span> WEATHER: &#123;<br>    retCursor = mOpenHelper.getReadableDatabase().query(<br>            WeatherContract.WeatherEntry.TABLE_NAME,<br>            projection,<br>            selection,<br>            selectionArgs,<br>            <span class="hljs-keyword">null</span>,<br>            <span class="hljs-keyword">null</span>,<br>            sortOrder<br>    );<br>    <span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-keyword">case</span> LOCATION: &#123;<br>    retCursor = mOpenHelper.getReadableDatabase().query(<br>            WeatherContract.LocationEntry.TABLE_NAME,<br>            projection,<br>            selection,<br>            selectionArgs,<br>            <span class="hljs-keyword">null</span>,<br>            <span class="hljs-keyword">null</span>,<br>            sortOrder<br>    );<br>    <span class="hljs-keyword">break</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<p><img src="/img/adnroid-developing/5/6.png"></p>
<p>다음과 같이 우리는 테이블관의 관계를 설정했습니다<br>Join을 사용하여 쿼리를 구현하는 방법을 설명하겠습니다</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> SQLiteQueryBuilder sWeatherByLocationSettingQueryBuilder;<br></code></pre></td></tr></table></figure>

<p>SQLiteQueryBuilder는 Query를 완성하는데 도움을 줍니다</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java">sWeatherByLocationSettingQueryBuilder.setTables(<br>        WeatherContract.WeatherEntry.TABLE_NAME + <span class="hljs-string">&quot; INNER JOIN &quot;</span> +<br>                WeatherContract.LocationEntry.TABLE_NAME +<br>                <span class="hljs-string">&quot; ON &quot;</span> + WeatherContract.WeatherEntry.TABLE_NAME +<br>                <span class="hljs-string">&quot;.&quot;</span> + WeatherContract.WeatherEntry.COLUMN_LOC_KEY +<br>                <span class="hljs-string">&quot; = &quot;</span> + WeatherContract.LocationEntry.TABLE_NAME +<br>                <span class="hljs-string">&quot;.&quot;</span> + WeatherContract.LocationEntry._ID);<br></code></pre></td></tr></table></figure>
<p>setTables는 SQL 쿼리의 내용의 일부를 설명하게 됩니다</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> String sLocationSettingSelection =<br>        WeatherContract.LocationEntry.TABLE_NAME +<br>                <span class="hljs-string">&quot;.&quot;</span> + WeatherContract.LocationEntry.COLUMN_LOCATION_SETTING + <span class="hljs-string">&quot; = ? &quot;</span>;<br></code></pre></td></tr></table></figure>

<p>기본형 쿼리를 완성해 두고 ? 에는 우리가 전달하는 값이 들어갑니다</p>
<p>getWeatherByLocationSetting()<br>getWeatherByLocationSettingAndDate()</p>
<p>메서드에서 사용하는 모습을 볼 수 있습니다</p>
<p><strong>이제 insert를 해봅시다</strong></p>
<p>다른 함수와 마찬가지로 UriMatcher를 이용해서 합니다<br>insert는 단순합니다<br>테이블에 맞는 데이터를 맞게 insert 하면 됩니다<br>ContentValues를 이용해서 삽입합니다</p>
<p>그러나 어려운 점이 존재합니다!<br>데이터베이스의 데이터를 삽입하면 변경된 데이터를 가질 가능성이 있는 모든 곳에 알려줘야 합니다</p>
<p>루트가 되는 URI에 알림을 하면 하위의 모든 URI에 알림이 됩니다<br>ContentResolver를 사용해서 ContentObserver에게 알려 줄 수 있다</p>
<p>하위 URI에만 알림을 해주면 루트 URI에는 알림이 오지 않습니다<br>항상 이점을 명심하고 주의해야합니다</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">case</span> WEATHER: &#123;<br>    normalizeDate(values);<br>    <span class="hljs-keyword">long</span> _id = db.insert(WeatherContract.WeatherEntry.TABLE_NAME, <span class="hljs-keyword">null</span>, values);<br>    <span class="hljs-keyword">if</span> (_id &gt; <span class="hljs-number">0</span>)<br>        returnUri = WeatherContract.WeatherEntry.buildWeatherUri(_id);<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> android.database.SQLException(<span class="hljs-string">&quot;Failed to insert row into &quot;</span> + uri);<br>    <span class="hljs-keyword">break</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>데이터 삽입이 정상적으로 이루어졌는지 검사를 하고 애러 처리까지 해줍니다<br>_id 까지 포함이 된 Uri를 만들어서 반환해 주면 끝입니다</p>
<p>ContentProvider를 완벽히 구현한다면 Contract, UriMatcher, query 함수 의 URI형을 다 구현해야 합니다</p>
<h2 id="연습-5"><a href="#연습-5" class="headerlink" title="연습"></a>연습</h2><ul>
<li>WeatherProvider.insert() 완성합니다</li>
<li>TestProvider.testInsertReadProvider 이용해서 테스트합니다</li>
</ul>
<h3 id="정답-5"><a href="#정답-5" class="headerlink" title="정답"></a>정답</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">case</span> LOCATION: &#123;<br>    <span class="hljs-keyword">long</span> _id = db.insert(WeatherContract.LocationEntry.TABLE_NAME, <span class="hljs-keyword">null</span>, values);<br>    <span class="hljs-keyword">if</span> (_id &gt; <span class="hljs-number">0</span>)<br>        returnUri = WeatherContract.LocationEntry.buildLocationUri(_id);<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> android.database.SQLException(<span class="hljs-string">&quot;Failed to insert row into &quot;</span> + uri);<br>    <span class="hljs-keyword">break</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<p><strong>남은 것은 update, delete입니다</strong><br>insert와 비슷합니다</p>
<p>다만 다른 점이라고 하면 삭제된 곳이나 변경이 된곳의 _id를 알려줘야 합니다<br>URI가 아닌 int (_id) 라는 점 입니다</p>
<p>테스트를 하기 전에 다음과 같이 변경 합니다</p>
<p><strong>TestDb.java</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title">deleteAllRecords</span><span class="hljs-params">()</span> </span>&#123;<br>    deleteAllRecordsFromProvider();<br>&#125;<br></code></pre></td></tr></table></figure>

<p>더 이상 DB로 직접 지우는 게 아니라 ContentProvider를 이용해야 하기 때문에 변경합니다</p>
<h2 id="연습-6"><a href="#연습-6" class="headerlink" title="연습"></a>연습</h2><ul>
<li>WeatherProvider.update, WeatherProvider.delete 완성합니다</li>
<li>TestProvider.testUpdateLocation, TestProvider.testDeleteRecords 이용해서 테스트합니다</li>
</ul>
<h3 id="정답-6"><a href="#정답-6" class="headerlink" title="정답"></a>정답</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">delete</span><span class="hljs-params">(Uri uri, String selection, String[] selectionArgs)</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> SQLiteDatabase db = mOpenHelper.getWritableDatabase();<br>    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> match = sUriMatcher.match(uri);<br>    <span class="hljs-keyword">int</span> rowsDeleted;<br><br>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">null</span> == selection) selection = <span class="hljs-string">&quot;1&quot;</span>;<br>    <span class="hljs-keyword">switch</span> (match) &#123;<br>        <span class="hljs-keyword">case</span> WEATHER:<br>            rowsDeleted = db.delete(<br>                    WeatherContract.WeatherEntry.TABLE_NAME, selection, selectionArgs);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> LOCATION:<br>            rowsDeleted = db.delete(<br>                    WeatherContract.LocationEntry.TABLE_NAME, selection, selectionArgs);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnsupportedOperationException(<span class="hljs-string">&quot;Unknown uri: &quot;</span> + uri);<br>    &#125;<br><br>    <span class="hljs-keyword">if</span> (rowsDeleted != <span class="hljs-number">0</span>) &#123;<br>        getContext().getContentResolver().notifyChange(uri, <span class="hljs-keyword">null</span>);<br>    &#125;<br>    db.close();<br>    <span class="hljs-keyword">return</span> rowsDeleted;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">update</span><span class="hljs-params">(Uri uri, ContentValues values, String selection, String[] selectionArgs)</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> SQLiteDatabase db = mOpenHelper.getWritableDatabase();<br>    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> match = sUriMatcher.match(uri);<br>    <span class="hljs-keyword">int</span> rowsUpdated;<br><br>    <span class="hljs-keyword">switch</span> (match) &#123;<br>        <span class="hljs-keyword">case</span> WEATHER:<br>            normalizeDate(values);<br>            rowsUpdated = db.update(WeatherContract.WeatherEntry.TABLE_NAME, values, selection,<br>                    selectionArgs);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">case</span> LOCATION:<br>            rowsUpdated = db.update(WeatherContract.LocationEntry.TABLE_NAME, values, selection,<br>                    selectionArgs);<br>            <span class="hljs-keyword">break</span>;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> UnsupportedOperationException(<span class="hljs-string">&quot;Unknown uri: &quot;</span> + uri);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (rowsUpdated != <span class="hljs-number">0</span>) &#123;<br>        getContext().getContentResolver().notifyChange(uri, <span class="hljs-keyword">null</span>);<br>    &#125;<br>    db.close();<br>    <span class="hljs-keyword">return</span> rowsUpdated;<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<p>우리는 다 완성 했습니다<br>하지만 좀 더 효율적으로 할 필요가 있습니다<br>Database를 다루다 보면 하나의 데이터를 삽입하는 것보다 여러개 데이터를 한번에 처리하는것이 더 빠릅니다<br>트랜잭션으로 그룹화 해서 처리하는게 더 효율적입니다</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">int</span> <span class="hljs-title">bulkInsert</span><span class="hljs-params">(Uri uri, ContentValues[] values)</span> </span>&#123;<br>    <span class="hljs-keyword">final</span> SQLiteDatabase db = mOpenHelper.getWritableDatabase();<br>    <span class="hljs-keyword">final</span> <span class="hljs-keyword">int</span> match = sUriMatcher.match(uri);<br>    <span class="hljs-keyword">switch</span> (match) &#123;<br>        <span class="hljs-keyword">case</span> WEATHER:<br>            db.beginTransaction();<br>            <span class="hljs-keyword">int</span> returnCount = <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">try</span> &#123;<br>                <span class="hljs-keyword">for</span> (ContentValues value : values) &#123;<br>                    normalizeDate(value);<br>                    <span class="hljs-keyword">long</span> _id = db.insert(WeatherContract.WeatherEntry.TABLE_NAME, <span class="hljs-keyword">null</span>, value);<br>                    <span class="hljs-keyword">if</span> (_id != -<span class="hljs-number">1</span>) &#123;<br>                        returnCount++;<br>                    &#125;<br>                &#125;<br>                db.setTransactionSuccessful();<br>            &#125; <span class="hljs-keyword">finally</span> &#123;<br>                db.endTransaction();<br>            &#125;<br>            getContext().getContentResolver().notifyChange(uri, <span class="hljs-keyword">null</span>);<br>            <span class="hljs-keyword">return</span> returnCount;<br>        <span class="hljs-keyword">default</span>:<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>.bulkInsert(uri, values);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><strong>setTransactionSuccessful()를 호출하지 않으면 기록이 되지 않는다는 점을 명심하세여</strong></p>
<p>ContentProvider를 완벽하게 다 만들었습니다</p>
<p><img src="/img/adnroid-developing/5/3.png"></p>
<ol>
<li>Application 에서 지원하는 URI를 결정했습니다</li>
<li>Contract의 UriMatcher와 관련된 내용을 추가하였습니다</li>
<li>URI를 각각 지원하는 UriMatcher를 사용해서 구현했습니다</li>
<li>ContentProvider의 6개의 함수를 구현했습니다</li>
</ol>
<hr>
<h2 id="FetchWeatherTask-Refactoring"><a href="#FetchWeatherTask-Refactoring" class="headerlink" title="FetchWeatherTask Refactoring"></a>FetchWeatherTask Refactoring</h2><p>ContentProvider를 완성했으니 이제 코드를 Refactoring을 합시다<br>기존에 FetchWeatherTask class를 파일로 빼고 수정을 합니다</p>
<p>package 폴더<br><a href="/downloads/code/5/FetchWeatherTask.java">FetchWeatherTask.java</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title">updateWeather</span><span class="hljs-params">()</span> </span>&#123;<br>    FetchWeatherTask fetchWeatherTask = <span class="hljs-keyword">new</span> FetchWeatherTask(getActivity(), mForecastAdapter);<br>    <span class="hljs-comment">// 생략</span><br>&#125;<br></code></pre></td></tr></table></figure>

<p>FetchWeatherTask의 생성자를 살펴보면 다음 코드를 이해할 수 있습니다</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-title">FetchWeatherTask</span><span class="hljs-params">(Context context, ArrayAdapter&lt;String&gt; forecastAdapter)</span> </span>&#123;<br>        mContext = context;<br>        mForecastAdapter = forecastAdapter;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>FetchWeatherTask.addLocation() 메서드를 완성 해 봅시다<br>도시의 이름, 위도, 경도를 입력하게 됩니다</p>
<p>DB에 있는 도시이면 id 값을 찾아서 반환하고, 없는 도시이면 저장 후 반환합니다</p>
<h2 id="연습-7"><a href="#연습-7" class="headerlink" title="연습"></a>연습</h2><ul>
<li>FetchWeatherTask.addLocation() 완성합니다</li>
<li>TestFetchWeatherTask.testAddLocation() 이용해서 테스트합니다</li>
</ul>
<h3 id="정답-7"><a href="#정답-7" class="headerlink" title="정답"></a>정답</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-function"><span class="hljs-keyword">long</span> <span class="hljs-title">addLocation</span><span class="hljs-params">(String locationSetting, String cityName, <span class="hljs-keyword">double</span> lat, <span class="hljs-keyword">double</span> lon)</span> </span>&#123;<br>    <span class="hljs-keyword">long</span> locationId;<br><br>    Cursor locationCursor = mContext.getContentResolver().query(<br>            WeatherContract.LocationEntry.CONTENT_URI,<br>            <span class="hljs-keyword">new</span> String[]&#123;WeatherContract.LocationEntry._ID&#125;,<br>            WeatherContract.LocationEntry.COLUMN_LOCATION_SETTING + <span class="hljs-string">&quot; = ?&quot;</span>,<br>            <span class="hljs-keyword">new</span> String[]&#123;locationSetting&#125;,<br>            <span class="hljs-keyword">null</span>);<br><br>    <span class="hljs-keyword">if</span> (locationCursor.moveToFirst()) &#123;<br>        <span class="hljs-keyword">int</span> locationIdIndex = locationCursor.getColumnIndex(WeatherContract.LocationEntry._ID);<br>        locationId = locationCursor.getLong(locationIdIndex);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        ContentValues locationValues = <span class="hljs-keyword">new</span> ContentValues();<br><br>        locationValues.put(WeatherContract.LocationEntry.COLUMN_CITY_NAME, cityName);<br>        locationValues.put(WeatherContract.LocationEntry.COLUMN_LOCATION_SETTING, locationSetting);<br>        locationValues.put(WeatherContract.LocationEntry.COLUMN_COORD_LAT, lat);<br>        locationValues.put(WeatherContract.LocationEntry.COLUMN_COORD_LONG, lon);<br><br>        Uri insertedUri = mContext.getContentResolver().insert(<br>                WeatherContract.LocationEntry.CONTENT_URI,<br>                locationValues<br>        );<br><br>        locationId = ContentUris.parseId(insertedUri);<br>    &#125;<br><br>    locationCursor.close();<br>    <span class="hljs-keyword">return</span> locationId;<br>&#125;<br></code></pre></td></tr></table></figure>

<hr>
<p>bulkInsert는 트랙잭션을 효율적으로 이용하여서 여러개의 데이터를 효율적으로 삽입할 수 있습니다</p>
<p>우리는 기존의 일주일 데이터가 아닌 2주일 데이터를 저장도록 합시다</p>
<h2 id="연습-8"><a href="#연습-8" class="headerlink" title="연습"></a>연습</h2><ul>
<li>FetchWeatherTask.getWeatherDataFromJson() 완성합니다</li>
<li>TestProvider.testBulkInsert() 이용해서 테스트합니다</li>
</ul>
<h3 id="정답-8"><a href="#정답-8" class="headerlink" title="정답"></a>정답</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">if</span> (cVVector.size() &gt; <span class="hljs-number">0</span>) &#123;<br>    ContentValues[] cvArray = <span class="hljs-keyword">new</span> ContentValues[cVVector.size()];<br>    cVVector.toArray(cvArray);<br>    mContext.getContentResolver().bulkInsert(WeatherEntry.CONTENT_URI, cvArray);<br>&#125;<br><br>String sortOrder = WeatherEntry.COLUMN_DATE + <span class="hljs-string">&quot; ASC&quot;</span>;<br>Uri weatherForLocationUri = WeatherEntry.buildWeatherLocationWithStartDate(<br>        locationSetting, System.currentTimeMillis());<br><br>Cursor cur = mContext.getContentResolver().query(weatherForLocationUri,<br>        <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, <span class="hljs-keyword">null</span>, sortOrder);<br><br>cVVector = <span class="hljs-keyword">new</span> Vector&lt;ContentValues&gt;(cur.getCount());<br><span class="hljs-keyword">if</span> (cur.moveToFirst()) &#123;<br>    <span class="hljs-keyword">do</span> &#123;<br>        ContentValues cv = <span class="hljs-keyword">new</span> ContentValues();<br>        DatabaseUtils.cursorRowToContentValues(cur, cv);<br>        cVVector.add(cv);<br>    &#125; <span class="hljs-keyword">while</span> (cur.moveToNext());<br>&#125;<br></code></pre></td></tr></table></figure>

<p>이제 실행하면 이주일 동안의 날씨 정보를 볼 수 있습니다</p>
<hr>
<h1 id="복습은-필수"><a href="#복습은-필수" class="headerlink" title="복습은 필수"></a>복습은 필수</h1><ul>
<li>ContentProvider</li>
<li>URI 설계</li>
<li>UriMatcher</li>
<li>ContentProvider Registry</li>
<li>ContentProvider 6 function</li>
<li>FetchWeatherTask Refactoring</li>
</ul>

    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>Post author:  </strong>Hoyuo
  </li>
  <li class="post-copyright-link">
    <strong>Post link: </strong>
    <a href="https://hoyuo.github.io/2017/02/12/adnroid-developing/Developing-Android-Apps-05/" title="5. Content Providers">https://hoyuo.github.io/2017/02/12/adnroid-developing/Developing-Android-Apps-05/</a>
  </li>
  <li class="post-copyright-license">
    <strong>Copyright Notice:  </strong>All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> unless stating additionally.
  </li>
</ul>
</div>


      <footer class="post-footer">
          
          <div class="post-tags">
              <a href="/tags/udacity/" rel="tag"><i class="fa fa-tag"></i> udacity</a>
              <a href="/tags/android/" rel="tag"><i class="fa fa-tag"></i> android</a>
          </div>

        
  <div class="post-widgets">
    <div class="wp_rating">
      <div id="wpac-rating"></div>
    </div>
  </div>


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2017/02/09/adnroid-developing/Developing-Android-Apps-04/" rel="prev" title="4. Activity Lifecycle and Data">
      <i class="fa fa-chevron-left"></i> 4. Activity Lifecycle and Data
    </a></div>
      <div class="post-nav-item">
    <a href="/2017/02/15/adnroid-developing/Developing-Android-Apps-06/" rel="next" title="6. Hooking it up with Loaders">
      6. Hooking it up with Loaders <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    <div class="comments" id="gitalk-container"></div>

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          목차
        </li>
        <li class="sidebar-nav-overview">
          흝어보기
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#Content-Providers"><span class="nav-number">1.</span> <span class="nav-text">Content Providers</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Content-Uri"><span class="nav-number">2.</span> <span class="nav-text">Content Uri</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-Application-%EC%97%90%EC%84%9C-%EC%A7%80%EC%9B%90%ED%95%98%EB%8A%94-URI%EB%A5%BC-%EA%B2%B0%EC%A0%95%ED%95%A9%EB%8B%88%EB%8B%A4"><span class="nav-number">2.1.</span> <span class="nav-text">1. Application 에서 지원하는 URI를 결정합니다</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%97%B0%EC%8A%B5"><span class="nav-number">3.</span> <span class="nav-text">연습</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%A0%95%EB%8B%B5"><span class="nav-number">3.1.</span> <span class="nav-text">정답</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UriMatcher"><span class="nav-number">4.</span> <span class="nav-text">UriMatcher</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%97%B0%EC%8A%B5-1"><span class="nav-number">5.</span> <span class="nav-text">연습</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%A0%95%EB%8B%B5-1"><span class="nav-number">5.1.</span> <span class="nav-text">정답</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ContentProvider-Registry"><span class="nav-number">6.</span> <span class="nav-text">ContentProvider Registry</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%97%B0%EC%8A%B5-2"><span class="nav-number">7.</span> <span class="nav-text">연습</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%A0%95%EB%8B%B5-2"><span class="nav-number">7.1.</span> <span class="nav-text">정답</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ContentProvider-6-function"><span class="nav-number">8.</span> <span class="nav-text">ContentProvider 6 function</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%97%B0%EC%8A%B5-3"><span class="nav-number">9.</span> <span class="nav-text">연습</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%A0%95%EB%8B%B5-3"><span class="nav-number">9.1.</span> <span class="nav-text">정답</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%97%B0%EC%8A%B5-4"><span class="nav-number">10.</span> <span class="nav-text">연습</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%A0%95%EB%8B%B5-4"><span class="nav-number">10.1.</span> <span class="nav-text">정답</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%97%B0%EC%8A%B5-5"><span class="nav-number">11.</span> <span class="nav-text">연습</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%A0%95%EB%8B%B5-5"><span class="nav-number">11.1.</span> <span class="nav-text">정답</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%97%B0%EC%8A%B5-6"><span class="nav-number">12.</span> <span class="nav-text">연습</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%A0%95%EB%8B%B5-6"><span class="nav-number">12.1.</span> <span class="nav-text">정답</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#FetchWeatherTask-Refactoring"><span class="nav-number">13.</span> <span class="nav-text">FetchWeatherTask Refactoring</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%97%B0%EC%8A%B5-7"><span class="nav-number">14.</span> <span class="nav-text">연습</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%A0%95%EB%8B%B5-7"><span class="nav-number">14.1.</span> <span class="nav-text">정답</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%EC%97%B0%EC%8A%B5-8"><span class="nav-number">15.</span> <span class="nav-text">연습</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%EC%A0%95%EB%8B%B5-8"><span class="nav-number">15.1.</span> <span class="nav-text">정답</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%EB%B3%B5%EC%8A%B5%EC%9D%80-%ED%95%84%EC%88%98"><span class="nav-number"></span> <span class="nav-text">복습은 필수</span></a></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Hoyuo</p>
  <div class="site-description" itemprop="description">Hoyuo's programming writting</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">45</span>
          <span class="site-state-item-name">포스트</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">카테고리</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">태그</span></a>
      </div>
  </nav>
</div>
  <div class="cc-license motion-element" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Hoyuo</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  



  <script>
  if (CONFIG.page.isPost) {
    wpac_init = window.wpac_init || [];
    wpac_init.push({
      widget: 'Rating',
      id    : 30567,
      el    : 'wpac-rating',
      color : '#fc6423'
    });
    (function() {
      if ('WIDGETPACK_LOADED' in window) return;
      WIDGETPACK_LOADED = true;
      var mc = document.createElement('script');
      mc.type = 'text/javascript';
      mc.async = true;
      mc.src = '//embed.widgetpack.com/widget.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
    })();
  }
  </script>

  
<script src="/js/local-search.js"></script>









<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>


<script>
if (document.querySelectorAll('pre.mermaid').length) {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js', () => {
    mermaid.initialize({
      theme    : 'forest',
      logLevel : 3,
      flowchart: { curve     : 'linear' },
      gantt    : { axisFormat: '%m/%d/%Y' },
      sequence : { actorMargin: 50 }
    });
  }, window.mermaid);
}
</script>


  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
NexT.utils.loadComments(document.querySelector('#gitalk-container'), () => {
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID    : '79c048e4f0067cf8561e',
      clientSecret: '2143a9396e1b205817582122455e850a93254adf',
      repo        : 'gtalk',
      owner       : 'hoyuo',
      admin       : ['hoyuo'],
      id          : 'e8dd42e6f6d74542f740b7315089c969',
        language: '',
      distractionFreeMode: true
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
});
</script>

</body>
</html>
